<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        select {
            min-width: 110px;
            margin-left: 5px;
        }

        body {
            min-height: 100vh;
        }

        select~span.btn:not(.imprBtn) {
            min-width: 230px;
            display: block;
        }

        .cursor div {
            cursor: pointer;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        .swal-modal {
            width: 85% !important;
        }



        @media screen and(min-width:767px) and (max-width:1000px) {

            .inputs {
                display: block !important;
            }

            .imprBtn {
                max-width: 130px !important;
            }
        }

        @media screen and (max-width:767px) {

            .main #F>div,
            .main #Groupe>div {
                display: block !important;

            }


            select~span.btn,
            .imprBtn {
                display: block;
                min-width: 230px !important;
                margin: 10px;
            }

            .btns {
                display: block !important;
            }

            select {
                margin-left: 0;
            }

            .main input {
                margin-bottom: 10px;
            }
        }
    </style>

</head>

<body class="container">
    <form class="d-flex mt-2">
        <input type="file" id="excel-file" accept=".xlsx, .xls" class="form-control" />
        <span id="read-button" class="btn btn-success ml-1" onclick="handleFile(false)">Upload</span>
    </form>
    <div class="main m-3">
        <div class="d-flex cursor" id="btnController">
            <div class="btn-success rounded w-100 text-center p-2 mr-1 border"><b>Formateur</b></div>
            <div class="rounded w-100 text-center p-2 ml-1 btn-outline-success border"><b>Groupe</b></div>
        </div>

        <div id="Formateur">
            <div class="d-flex justify-content-end py-3 align-items-center inputs">
                <input type="search" class="rechercher form-control m-3 " placeholder="Rechercher un Formateur...">
                <!-- <span class="btn btn-dark ml-1" onclick="Descendant('Formateur')">Descendant</span> -->
                <div class="d-flex btns">
                    <select id="select" onchange="descOrAsc('Formateur', this)" class="form-control">
                        <option value="" disabled selected>Trier</option>
                        <option value="descendant"><b>Descendant</b></option>
                        <option value="ascendant"><b>Ascendant</b></option>
                        <option value="nom"><b>Par Nom</b></option>
                    </select>
                    <span id="read-button" class="btn btn-info ml-1  ForModReg"
                        onclick="afficheformateurEFM()">Formateurs ayant des EFMR</span>
                    <span id="read-button" class="btn btn-success ml-1" onclick="afficheModule5h()">Modules presque
                        achevés</span>
                    <span class="btn btn-primary  imprBtn ml-1" id="downloadFor">Imprimer</span>
                    <span class="btn btn-secondary  imprBtn ml-1 autreBtn"><i class="bi bi-list"></i></span>

                </div>
            </div>
            <table class="table table-bordered table-hover text-center table-responsive-md">
            </table>
        </div>

        <div id="Groupe" class="d-none">
            <div class="d-flex justify-content-end py-3 align-items-center inputs">
                <input type="search" class="rechercher form-control mx-auto m-3" placeholder="Rechercher un Groupe...">
                <!-- <span class="btn btn-dark ml-1" onclick="Descendant('Groupe')">Descendant</span> -->
                <div class="btns d-flex">
                    <select id="select" onchange="descOrAsc('Groupe', this)" class="form-control">
                        <option value="" disabled selected>Trier</option>
                        <option value="descendant"><b>Descendant</b></option>
                        <option value="ascendant"><b>Ascendant</b></option>
                        <option value="nom"><b>Par Nom</b></option>
                    </select>
                    <span id="read-button" class="btn btn-info ml-1 ForModReg"
                        onclick="afficheformateurEFM()">Formateurs ayant des EFMR</span>

                    <span id="read-button" class="btn btn-success ml-1" onclick="afficheModule5h()">Modules presque
                        achevés</span>
                    <span class="btn btn-primary imprBtn ml-1" id="downloadGr">Imprimer</span>
                    <span class="btn btn-secondary  imprBtn ml-1 autreBtn"><i class="bi bi-list"></i></span>
                </div>
            </div>
            <table class="table table-bordered table-hover text-center table-responsive-md">

            </table>
        </div>


    </div>

    <div class="d-none justify-content-center align-items-center divSpiner" style="height: 100vh;width: 100%;">
        <div class="spinner-border" role="status" aria-hidden="true"></div>
        <strong class="ml-2">Loading...</strong>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.7/xlsx.full.min.js"></script>
    <script>
        handleFile(true);
        function handleFile(local = false) {
            if (!localStorage.jsonData) {
                localStorage.jsonData = '[]';
            }

            if (local == false) {

                tret().then(function () {

                    show(JSON.parse(localStorage.jsonData));
                    location.reload();

                })

            } else {

                show(JSON.parse(localStorage.jsonData));

            }


        }

        function tret() {
            return new Promise((resolve, reject) => {
                const fileInput = document.getElementById('excel-file');
                const file = fileInput.files[0];

                const reader = new FileReader();

                reader.onload = function (e) {

                    const data = e.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    localStorage.jsonData = JSON.stringify(jsonData);

                };

                reader.readAsBinaryString(file);

                resolve();

            })
        }

        function show(jsonData) {
            let formateurs = [];

            jsonData.forEach((e) => {
                if (!formateurs.includes(e['Formateur Affecté Présentiel Actif'])) {
                    let nomForm = e['Formateur Affecté Présentiel Actif'];
                    formateurs.push(nomForm);
                }
            });

            formateurs.sort();


            let table = document.querySelector('#Formateur table');
            table.innerHTML = `
        <tr class="bg-secondary text-light">
            <th>Matricule</th>
            <th>Nom Complet</th>
            <th>MH Affectée Globale</th>
            <th>MH Réalisée Globale</th>
            <th>Avancement</th>
        </tr>
    `
            let tableFormateur;
            let listModulesRegional;
            let listModulesLocauxValider;
            let objModule;

            formateurs.forEach(formateur => {

                tableFormateur = jsonData.filter(e => e['Formateur Affecté Présentiel Actif'] == formateur)

                let MHAfectGlobal = 0;
                let MHRealisGlobal = 0;
                let MHAfectGlobalS1 = 0;
                let MHRealisGlobalS1 = 0;
                let MHAfectGlobalS2 = 0;
                let MHRealisGlobalS2 = 0;
                let MHAfectGlobalS1P = 0;
                let MHRealisGlobalS1P = 0;
                let MHAfectGlobalS2P = 0;
                let MHRealisGlobalS2P = 0;
                let MHAfectGlobalS1SYN = 0;
                let MHRealisGlobalS1SYN = 0;
                let MHAfectGlobalS2SYN = 0;
                let MHRealisGlobalS2SYN = 0;

                let listS1 = []
                let listS2 = [];

                let annees = [];
                listModulesRegional = [];
                listModulesLocauxValider = [];


                tableFormateur.forEach(objFormateur => {

                    let p = ((objFormateur['MH Réalisée Globale'] || 0) * 100) / (objFormateur["MH Affectée Globale (P & SYN)"] || (Number(objFormateur["MH Totale  DRIF"]) - Number(objFormateur["MHASYN Totale DRIF"])));

                    objModule = {
                        p: p.toFixed(2),
                        codeM: objFormateur['Code Module'],
                        nom: `${objFormateur['Code Module']}-${objFormateur['Module']}`,
                        group: objFormateur['Groupe'],
                        regional: objFormateur['Régional'],
                        s1: objFormateur['MH Totale S1 DRIF'],
                        s2: objFormateur['MH Totale S2 DRIF'],
                        MHAG: (objFormateur["MH Affectée Globale (P & SYN)"] || (Number(objFormateur["MH Totale  DRIF"]) - Number(objFormateur["MHASYN Totale DRIF"]))),
                        MHAP: objFormateur["MH Affectée Présentiel"] || objFormateur['MHP Totale DRIF'] || 0,
                        MHAS: objFormateur["MH Affectée Sync"] || objFormateur['MHSYN Totale DRIF'] || 0,
                        MHRP: objFormateur['MH Réalisée Présentiel'] || Number(0).toFixed(2),
                        MHRS: objFormateur['MH Réalisée Sync'] || Number(0).toFixed(2),
                        MHRG: objFormateur['MH Réalisée Globale'] || Number(0).toFixed(2),
                        valider: objFormateur['Séance EFM']
                    }
                    if (objModule.regional == 'O') {
                        listModulesRegional.push(objModule);
                    } else if (objModule.valider) {
                        listModulesLocauxValider.push(objModule)
                    }

                    if (!annees.includes(objFormateur["Année de formation"])) {

                        annees.push(objFormateur["Année de formation"]);

                    }

                    MHRealisGlobal += Number(objFormateur['MH Réalisée Présentiel']) || 0;
                    MHAfectGlobal += Number(objFormateur["MH Affectée Présentiel"] || objFormateur['MHP Totale DRIF'] || 0);

                    if (objFormateur["Groupe"].includes("TREMOA") && (objFormateur["Module"].includes("Compétences") ||
                        objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais"))) {

                        MHRealisGlobal += Number(objFormateur['MH Réalisée Sync']) || 0;
                        if (objFormateur["MH Affectée Sync"]) {
                            MHAfectGlobal += Number(objFormateur["MH Affectée Sync"]);
                        }
                        else {
                            MHAfectGlobal += Number(objFormateur["MHSYN Totale DRIF"]) || 0;

                        }


                    }
                    if (objFormateur['MH Totale S1 DRIF'] != 0 && objFormateur['MH Totale S1 DRIF'] >= objFormateur['MH Totale S2 DRIF']) {
                        listS1.push(objFormateur)
                        if (objFormateur["Groupe"].includes("TREMOA")) {
                            if (objFormateur["MH Affectée Présentiel"]) {
                                MHAfectGlobalS1 += Number(objFormateur["MH Affectée Présentiel"]);
                                MHAfectGlobalS1P += Number(objFormateur["MH Affectée Présentiel"]) || 0;

                            }
                            else {
                                MHAfectGlobalS1 += Number(objFormateur["MHP Totale DRIF"]) || 0;
                                MHAfectGlobalS1P += Number(objFormateur["MHP Totale DRIF"]) || 0;

                            }
                            MHRealisGlobalS1 += Number(objFormateur["MH Réalisée Présentiel"]) || 0;
                            MHRealisGlobalS1P += Number(objFormateur["MH Réalisée Présentiel"]) || 0;

                            if (objFormateur["Module"].includes("Compétences") ||
                                objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais")) {
                                if (objFormateur["MH Affectée Sync"]) {
                                    MHAfectGlobalS1 += Number(objFormateur["MH Affectée Sync"]);
                                    MHAfectGlobalS1SYN += Number(objFormateur["MH Affectée Sync"]) || 0;

                                }
                                else {
                                    MHAfectGlobalS1 += Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                    MHAfectGlobalS1SYN += Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                }


                                MHRealisGlobalS1 += Number(objFormateur["MH Réalisée Sync"]) || 0;
                                MHRealisGlobalS1SYN += Number(objFormateur["MH Réalisée Sync"]) || 0;


                            }
                        } else {
                            if (objFormateur['MH Totale S2 DRIF'] != 0) {
                                MHAfectGlobalS2 += Number(objFormateur['MHP S2 DRIF'])
                                MHAfectGlobalS2P += Number(objFormateur['MHP S2 DRIF'])
                                listS2.push(objFormateur)
                                let dif = Number(objFormateur["MH Réalisée Présentiel"]) - Number(objFormateur['MHP S1 DRIF'])
                                if (dif > 0) {
                                    MHRealisGlobalS2 += Number(dif)
                                    MHRealisGlobalS2P += Number(dif)
                                    MHRealisGlobalS1 -= Number(dif)
                                    MHRealisGlobalS1P -= Number(dif)

                                }


                            }
                            MHAfectGlobalS1 += Number(objFormateur['MHP S1 DRIF'])
                            MHRealisGlobalS1 += Number(objFormateur['MH Réalisée Présentiel']) || 0;
                            MHAfectGlobalS1P += Number(objFormateur['MHP S1 DRIF'])
                            MHRealisGlobalS1P += Number(objFormateur['MH Réalisée Présentiel']) || 0;
                        }
                    }
                    if (objFormateur['MH Totale S2 DRIF'] != 0 && objFormateur['MH Totale S1 DRIF'] < objFormateur['MH Totale S2 DRIF']) {
                        listS2.push(objFormateur)
                        if (objFormateur["Groupe"].includes("TREMOA")) {
                            if (objFormateur["MH Affectée Présentiel"]) {
                                MHAfectGlobalS2 += Number(objFormateur["MH Affectée Présentiel"]);
                                MHAfectGlobalS2P += Number(objFormateur["MH Affectée Présentiel"]) || 0;

                            }
                            else {
                                MHAfectGlobalS2 += Number(objFormateur["MHP Totale DRIF"]) || 0;
                                MHAfectGlobalS2P += Number(objFormateur["MHP Totale DRIF"]) || 0;

                            }



                            MHRealisGlobalS2 += Number(objFormateur["MH Réalisée Présentiel"]) || 0;
                            MHRealisGlobalS2P += Number(objFormateur["MH Réalisée Présentiel"]) || 0;
                            if (objFormateur["Module"].includes("Compétences") ||
                                objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais")) {

                                MHRealisGlobalS2 += Number(objFormateur["MH Réalisée Sync"]) || 0;
                                MHAfectGlobalS2 += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                MHRealisGlobalS2SYN += Number(objFormateur["MH Réalisée Sync"]) || 0;
                                MHAfectGlobalS2SYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                            }

                        } else {
                            MHAfectGlobalS2 += Number(objFormateur['MHP S2 DRIF'])
                            MHRealisGlobalS2 += Number(objFormateur['MH Réalisée Présentiel']) || 0;
                            MHAfectGlobalS2P += Number(objFormateur['MHP S2 DRIF'])
                            MHRealisGlobalS2P += Number(objFormateur['MH Réalisée Présentiel']) || 0;
                            if (objFormateur['MH Totale S1 DRIF'] != 0) {
                                MHAfectGlobalS1 += Number(objFormateur['MHP S1 DRIF'])
                                MHAfectGlobalS1P += Number(objFormateur['MHP S1 DRIF'])
                                listS1.push(objFormateur)
                                let dif = Number(objFormateur["MH Réalisée Présentiel"]) - Number(objFormateur['MHP S1 DRIF'])
                                if (dif < 0) {
                                    MHRealisGlobalS1 += Number(objFormateur['MH Réalisée Présentiel'])
                                    MHRealisGlobalS1P += Number(objFormateur['MH Réalisée Présentiel'])
                                    MHRealisGlobalS2 -= Number(objFormateur['MH Réalisée Présentiel'])
                                    MHRealisGlobalS2P -= Number(objFormateur['MH Réalisée Présentiel'])

                                }

                            }

                        }
                    }

                })

                let modules;
                let filieres;
                let Groupes;

                annees.forEach(annee => {

                    filieres = [];

                    tableFormateur.forEach(objFormateur => {

                        if (!filieres.includes(objFormateur['Code Filière']) && objFormateur["Année de formation"] == annee) {

                            filieres.push(objFormateur['Code Filière']);

                        }

                    })

                    filieres.forEach(e => {

                        modules = [];
                        tableFormateur.forEach(m => {

                            if (!modules.includes(m['Code Module']) && m["Année de formation"] == annee && m['Code Filière'] == e) {

                                modules.push(m['Code Module']);

                            }

                        })

                        Groupes = [];
                        modules.forEach(eM => {
                            tableFormateur.forEach(eD => {

                                if (!Groupes.includes(eD['Groupe']) && eD["Année de formation"] == annee && eD['Code Filière'] == e && eD['Code Module'] == eM) {

                                    Groupes.push(eD['Groupe'])

                                }

                            })
                            Groupes.sort();
                            // console.log(annee);
                            // console.log(e);
                            // console.log(eM);
                            // console.log(Groupes);
                            Groupes.forEach((gr, index) => {

                                if (index % 2 == 0) {

                                    // console.log(gr);

                                    tableFormateur.forEach(dt => {

                                        let condTr = !(dt["Groupe"].includes("TREMOA") && (dt["Module"].includes("Compétences") ||
                                            dt["Module"].includes("Français") || dt["Module"].includes("Anglais")))

                                        if (dt['Groupe'] == gr && condTr && dt["Année de formation"] == annee && dt['Code Filière'] == e && dt['Code Module'] == eM) {
                                            // console.log(condTr);
                                            MHAfectGlobal += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                            MHRealisGlobal += Number(dt['MH Réalisée Sync']) || 0;
                                            if (dt['MH Totale S1 DRIF'] != 0 && dt['MH Totale S1 DRIF'] >= dt['MH Totale S2 DRIF']) {
                                                if (dt["Groupe"].includes("TREMOA")) {
                                                    if (dt["MH Affectée Sync"]) {
                                                        MHAfectGlobalS1 += Number(dt["MH Affectée Sync"]);
                                                        MHAfectGlobalS1SYN += Number(dt["MH Affectée Sync"]) || 0;

                                                    }
                                                    else {
                                                        MHAfectGlobalS1 += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                        MHAfectGlobalS1SYN += Number(dt["MHSYN Totale DRIF"]) || 0;

                                                    }

                                                    MHRealisGlobalS1 += Number(dt["MH Réalisée Sync"]) || 0;
                                                    MHRealisGlobalS1SYN += Number(dt["MH Réalisée Sync"]) || 0;
                                                } else {

                                                    MHAfectGlobalS1 += Number(dt['MHSYN S1 DRIF'])
                                                    MHRealisGlobalS1 += Number(dt['MH Réalisée Sync']) || 0
                                                    MHAfectGlobalS1SYN += Number(dt['MHSYN S1 DRIF'])
                                                    MHRealisGlobalS1SYN += Number(dt['MH Réalisée Sync']) || 0
                                                    if (dt['MH Totale S2 DRIF'] != 0) {
                                                        MHAfectGlobalS2 += Number(dt['MHSYN S2 DRIF'])
                                                        MHAfectGlobalS2SYN += Number(dt['MHSYN S2 DRIF'])
                                                        let dif = Number(dt["MH Réalisée Sync"]) - Number(dt['MHSYN S1 DRIF'])

                                                        if (dif > 0) {
                                                            MHRealisGlobalS2 += Number(dif)
                                                            MHRealisGlobalS2SYN += Number(dif)
                                                            MHRealisGlobalS1 -= Number(dif)
                                                            MHRealisGlobalS1SYN -= Number(dif)

                                                        }

                                                    }
                                                }
                                            }
                                            if (dt['MH Totale S2 DRIF'] != 0 && dt['MH Totale S1 DRIF'] < dt['MH Totale S2 DRIF']) {
                                                if (dt["Groupe"].includes("TREMOA")) {
                                                    if (dt["MH Affectée Sync"]) {
                                                        MHAfectGlobalS2 += Number(dt["MH Affectée Sync"]);
                                                        MHAfectGlobalS2SYN += Number(dt["MH Affectée Sync"]) || 0;

                                                    }
                                                    else {
                                                        MHAfectGlobalS2 += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                        MHAfectGlobalS2SYN += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                    }

                                                    MHRealisGlobalS2 += Number(dt["MH Réalisée Sync"]) || 0;
                                                    MHRealisGlobalS2SYN += Number(dt["MH Réalisée Sync"]) || 0;
                                                } else {
                                                    if (dt['MH Totale S1 DRIF'] != 0) {
                                                        MHAfectGlobalS1 += Number(dt['MHSYN S1 DRIF'])
                                                        MHAfectGlobalS1SYN += Number(dt['MHSYN S1 DRIF'])
                                                        let dif = Number(dt["MH Réalisée Sync"]) - Number(dt['MHSYN S1 DRIF'])
                                                        if (dif < 0) {
                                                            MHRealisGlobalS1 += Number(dt['MH Réalisée Sync'])
                                                            MHRealisGlobalS1SYN += Number(dt['MH Réalisée Sync'])
                                                            MHRealisGlobalS2 -= Number(dt['MH Réalisée Sync'])
                                                            MHRealisGlobalS2SYN -= Number(dt['MH Réalisée Sync'])

                                                        }
                                                    }
                                                    MHAfectGlobalS2 += Number(dt['MHSYN S2 DRIF'])
                                                    MHRealisGlobalS2 += Number(dt['MH Réalisée Sync']) || 0
                                                    MHAfectGlobalS2SYN += Number(dt['MHSYN S2 DRIF'])
                                                    MHRealisGlobalS2SYN += Number(dt['MH Réalisée Sync']) || 0

                                                }
                                            }

                                        }

                                    })

                                }

                            })

                        })

                    })

                })

                let TauxMHRealisGlobal = MHRealisGlobal * 100 / MHAfectGlobal;

                if (formateur) {

                    let tr = document.createElement('tr');
                    tr.setAttribute('name', formateur)
                    tr.innerHTML = `
                        <td>${tableFormateur[0]['Mle Affecté Présentiel Actif']}</td>
                        <td>${formateur}</td>
                        <td>${MHAfectGlobal}</td>
                        <td>${MHRealisGlobal}</td>
                        <td>${TauxMHRealisGlobal.toFixed(2)}%</td>
                    `
                    let divParent = document.createElement('div')

                    let fieldset1 = document.createElement('fieldset');
                    let legend1 = document.createElement('legend');
                    legend1.innerHTML = '<h5>Modules Régionaux</h5>'
                    fieldset1.style = 'border:solid;padding-bottom: 20px;'
                    legend1.style = 'width:fit-content;padding: 0 10px;'
                    fieldset1.appendChild(legend1);

                    let listModulesRegionalS1 = listModulesRegional.filter(m => m.s1 != 0 && m.s1 >= m.s2);
                    let listModulesRegionalS2 = listModulesRegional.filter(m => m.s2 != 0 && m.s1 < m.s2);

                    let tableModule = document.createElement('table');
                    tableModule.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');
                    tableModule.innerHTML = `
                        
                        <tr class="bg-secondary text-light">
                            <td>N°</td>
                            <td>Nom</td>
                            <td>Groupe</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Réalisée Présentiel</td>
                            <td>MH Réalisée Sync</td>
                            <td>MH Réalisée Globale</td>
                            <td>Avancement</td>
                            <td>Réalisé</td>
                        </tr>
                        <tr class="bg-light">
                            <td colspan='11'><b>S1</b></td>
                        </tr>
                    `;

                    listModulesRegionalS1.sort(function (a, b) {
                        var numA = (a.group);
                        var numB = (b.group);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });
                    listModulesRegionalS1.sort(function (a, b) {
                        var numA = (a.codeM);
                        var numB = (b.codeM);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });


                    listModulesRegionalS1.forEach((m, i) => {

                        tableModule.innerHTML += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${m.nom}</td>
                            <td>${m.group}</td>
                            <td>${m.MHAP}</td>
                            <td>${m.MHAS}</td>
                            <td><b>${m.MHAG}</b></td>
                            <td>${m.MHRP}</td>
                            <td>${m.MHRS}</td>
                            <td><b>${m.MHRG}</b></td>
                            <td>${m.p}%</td>
                            <td>${m.valider}</td>
                        </tr>
                        `;
                    })
                    tableModule.innerHTML += `
                        <tr class="bg-light">
                            <td colspan='11'><b>S2</b></td>
                        </tr>
                       
                    `;

                    listModulesRegionalS2.sort(function (a, b) {
                        var numA = (a.group);
                        var numB = (b.group);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });
                    listModulesRegionalS2.sort(function (a, b) {
                        var numA = (a.codeM);
                        var numB = (b.codeM);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });

                    listModulesRegionalS2.forEach((m, i) => {

                        tableModule.innerHTML += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${m.nom}</td>
                            <td>${m.group}</td>
                            <td>${m.MHAP}</td>
                            <td>${m.MHAS}</td>
                            <td><b>${m.MHAG}</b></td>
                            <td>${m.MHRP}</td>
                            <td>${m.MHRS}</td>
                            <td><b>${m.MHRG}</b></td>
                            <td>${m.p}%</td>
                            <td>${m.valider}</td>
                        </tr>
                        `;
                    })
                    fieldset1.appendChild(tableModule);
                    divParent.appendChild(fieldset1);

                    let hr = document.createElement('hr')
                    divParent.appendChild(hr)


                    let fieldset2 = document.createElement('fieldset');
                    let legend2 = document.createElement('legend');
                    legend2.innerHTML = '<h5>Modules Locaux</h5>'
                    fieldset2.style = 'border:solid;padding-bottom: 20px;'
                    legend2.style = 'width:fit-content;padding: 0 10px;'
                    fieldset2.appendChild(legend2);

                    let listModulesLocauxValiderS1 = listModulesLocauxValider.filter(m => m.s1 != 0 && m.s1 >= m.s2);
                    let listModulesLocauxValiderS2 = listModulesLocauxValider.filter(m => m.s2 != 0 && m.s1 < m.s2);

                    let tableModule2 = document.createElement('table');
                    tableModule2.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');
                    tableModule2.innerHTML = `
                        
                        <tr class="bg-secondary text-light">
                            <td>N°</td>
                            <td>Nom</td>
                            <td>Groupe</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td >MH Affectée Globale (P & SYN)</td>
                            <td>MH Réalisée Présentiel</td>
                            <td>MH Réalisée Sync</td>
                            <td>MH Réalisée Globale</td>
                            <td>Avancement</td>
                            <td>Réalisé</td>
                        </tr>
                        <tr class="bg-light">
                            <td colspan='11'><b>S1</b></td>
                        </tr>
                    `;

                    listModulesLocauxValiderS1.sort(function (a, b) {
                        var numA = (a.group);
                        var numB = (b.group);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });
                    listModulesLocauxValiderS1.sort(function (a, b) {
                        var numA = (a.codeM);
                        var numB = (b.codeM);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });


                    listModulesLocauxValiderS1.forEach((m, i) => {

                        tableModule2.innerHTML += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${m.nom}</td>
                            <td>${m.group}</td>
                            <td>${m.MHAP}</td>
                            <td>${m.MHAS}</td>
                            <td><b>${m.MHAG}</b></td>
                            <td>${m.MHRP}</td>
                            <td>${m.MHRS}</td>
                            <td><b>${m.MHRG}<b></td>
                            <td>${m.p}%</td>
                            <td>${m.valider}</td>
                        </tr>
                        `;
                    })
                    tableModule2.innerHTML += `
                        <tr class="bg-light">
                            <td colspan='11'><b>S2</b></td>
                        </tr>
                       
                    `;

                    listModulesLocauxValiderS2.sort(function (a, b) {
                        var numA = (a.group);
                        var numB = (b.group);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });
                    listModulesLocauxValiderS2.sort(function (a, b) {
                        var numA = (a.codeM);
                        var numB = (b.codeM);
                        if (numA < numB) {
                            return -1; // a comes before b
                        }

                        if (numA > numB) {
                            return 1; // a comes after b
                        }

                        return 0; // names are equal
                    });

                    listModulesLocauxValiderS2.forEach((m, i) => {

                        tableModule2.innerHTML += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${m.nom}</td>
                            <td>${m.group}</td>
                            <td>${m.MHAP}</td>
                            <td>${m.MHAS}</td>
                            <td><b>${m.MHAG}</b></td>
                            <td>${m.MHRP}</td>
                            <td>${m.MHRS}</td>
                            <td><b>${m.MHRG}</b></td>
                            <td>${m.p}%</td>
                            <td>${m.valider}</td>
                        </tr>
                        `;
                    })

                    fieldset2.appendChild(tableModule2);
                    divParent.appendChild(fieldset2);
                    let tableModule3 = document.createElement('table');
                    tableModule3.setAttribute('class', 'table table-bordered table-hover text-center    MHCol');

                    tableModule3.innerHTML = `
                    <tr>
                    <td colspan='3' class="bg-secondary text-light" 
                    style="border-right:2.5px solid #dee1e6"><b>Affectée</b></td>
                    <td colspan='3' class="bg-secondary text-light"><b>Réalisée</b></td>
                    </tr>
                        
                        <tr class="bg-secondary text-light ">
                           
                            <td>MH Affectée Présentiel S1</td>
                            <td>MH Affectée Sync S1</td>
                            <td style="border-right:2.5px solid #dee2e6">MH Total Affectée S1</td>
                            
                            
                            <td>MH Réalisée Présentiel S1</td>
                            <td>MH Réalisée Sync S1</td>
                            <td>MH Total Réalisée S1</td>
             
                            <td>vitesse (Heure/Semaine) </td>
                        </tr>
  
                    `;
                    let vitesse = ((MHAfectGlobalS1 - MHRealisGlobalS1) / tempsRestant(new Date()))
                    let min = (vitesse - Math.floor(vitesse)) * 60
                    vitesse = Number(Math.floor(vitesse))
                    if (min >= 40) {
                        vitesse++
                    }
                    if (min < 40 && min >= 20) {
                        vitesse += 0.5
                    }
                    vitesse = (vitesse >= 0 && vitesse) || "-"
                    vitesse = (new Date() < new Date("2024/01/29") && vitesse) || "-"
                    tableModule3.innerHTML += `
                        <tr>
                            <td>${MHAfectGlobalS1P}</td>
                            <td>${MHAfectGlobalS1SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS1}</b></td>
                            <td>${MHRealisGlobalS1P}</td>
                            <td>${MHRealisGlobalS1SYN}</td>
                            <td><b>${MHRealisGlobalS1}</b></td>
                            <td>${vitesse}  </td>
                         
                        </tr>
                        `;
                    let fieldset3 = document.createElement('fieldset');
                    let legend3 = document.createElement('legend');


                    legend3.innerHTML = '<h5>Details S1</h5>'
                    fieldset3.style = 'border:solid;padding-bottom: 20px;'
                    legend3.style = 'width:fit-content;padding: 0 10px;'
                    fieldset3.appendChild(legend3);
                    fieldset3.appendChild(tableModule3);
                    let divButtonDet = document.createElement("div");
                    divButtonDet.className = "d-flex justify-content-end mr-2";
                    let buttonDet = document.createElement("button");
                    buttonDet.className = "btn btn-info";
                    buttonDet.innerText = "details S1"
                    buttonDet.addEventListener("click", () => detailsSFor(listS1, "S1"))
                    divButtonDet.append(buttonDet)
                    fieldset3.append(divButtonDet)

                    divParent.appendChild(fieldset3);
                    let tableModule4 = document.createElement('table');
                    tableModule4.setAttribute('class', 'table table-bordered table-hover text-center    MHCol');

                    tableModule4.innerHTML = `
                    <tr>
                    <td colspan='3' class="bg-secondary text-light" 
                    style="border-right:2.5px solid #dee1e6"><b>Affectée</b></td>
                    <td colspan='3' class="bg-secondary text-light"><b>Réalisée</b></td>
                    </tr>
                        <tr class="bg-secondary text-light ">
                           
                            <td>MH Affectée Présentiel S2</td>
                            <td>MH Affectée Sync S2</td>
                            <td style="border-right:2.5px solid #dee2e6">MH Total Affectée S2</td>
                            
                            
                            <td>MH Réalisée Présentiel S2</td>
                            <td>MH Réalisée Sync S2</td>
                            <td>MH Total Réalisée S2</td>
             
                            <td>vitesse (Heure/Semaine) </td>
                        </tr>
  
                    `;
                    let vitesse2 = (MHAfectGlobalS2 - MHRealisGlobalS2) / tempsRestant(new Date())
                    let diffS1 = MHAfectGlobalS1 - MHRealisGlobalS1

                    if (diffS1 > 0 && new Date() > new Date("2024/01/29")) {
                        vitesse2 = (MHAfectGlobalS2 + (diffS1) - MHRealisGlobalS2) / tempsRestant(new Date())
                    }
                    if (new Date() < new Date("2024/01/29")) {
                        vitesse2 = ((MHAfectGlobalS2 - MHRealisGlobalS2) / tempsRestant(new Date("2024/01/29")))
                    }
                    let min2 = (vitesse2 - Math.floor(vitesse2)) * 60
                    vitesse2 = Number(Math.floor(vitesse2))
                    if (min2 > 40) {
                        vitesse2++
                    }
                    if (min2 < 40 && min2 >= 20) {
                        vitesse2 += 0.5
                    }
                    if (new Date() > new Date("2024/01/29") && new Date() < new Date("2024/06/10")) {

                        tableModule4.innerHTML += `
                            <tr>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0}   ${diffS1 >= 0 && "+(" + diffS1 + " heure de S1)"}</td>
                             
                            </tr>
                            `;
                    }
                    else {
                        tableModule4.innerHTML += `
                            <tr>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0}   </td>
                             
                            </tr>
                            `;
                    }

                    let fieldset4 = document.createElement('fieldset');
                    let legend4 = document.createElement('legend');
                    legend4.innerHTML = '<h5>Details S2</h5>'
                    fieldset4.style = 'border:solid;padding-bottom: 20px;'
                    legend4.style = 'width:fit-content;padding: 0 10px;'
                    fieldset4.appendChild(legend4);
                    fieldset4.appendChild(tableModule4);
                    let divButtonDet2 = document.createElement("div");
                    divButtonDet2.className = "d-flex justify-content-end mr-2";
                    let buttonDet2 = document.createElement("button");
                    buttonDet2.className = "btn btn-info";
                    buttonDet2.innerText = "details S2"
                    buttonDet2.addEventListener("click", () => detailsSFor(listS2, "S2"))
                    divButtonDet2.append(buttonDet2)
                    fieldset4.append(divButtonDet2)
                    divParent.appendChild(fieldset4);

                    tr.onclick = () => {
                        swal({
                            title: formateur,
                            content: divParent,
                            buttons: [
                                'Ok',
                                'Imprimer'
                            ],
                        }).then(function (isConfirm) {
                            if (isConfirm) {
                                let imprimeD = document.createElement("div")
                                imprimeD.style.textAlign = "center"
                                imprimeD.innerHTML = `<h3 style="margin-bottom:20px">${formateur}</h3>`
                                imprimeD.append(divParent)
                                imprime(imprimeD, formateur)
                                swal({
                                    title: 'Imprimer!',
                                    text: `${formateur} imprimé(e) avec succes !`,
                                    icon: 'success'
                                })
                            };
                        })
                            ;


                    }
                    table.append(tr)
                }



            })

            ////////////////////////////////////////////////////////////////////////////

            let groups = [];

            jsonData.forEach((e) => {
                if (!groups.includes(e.Groupe)) {
                    let nomGroup = e.Groupe;
                    groups.push(nomGroup);
                }
            });

            groups.sort();

            let tableGroup;

            let taableG = document.querySelector('#Groupe table')
            taableG.innerHTML = `
        <tr class="bg-secondary text-light">
            <th>Groupe</th>
            <th>MH Affectée Globale</th>
            <th>MH Réalisée Globale</th>
            <th>Avancement</th>
        </tr>
    `;

            let listModulesRegionalGroupe;

            groups.forEach(group => {


                tableGroup = jsonData.filter(elt => elt.Groupe == group)

                // regional: objFormateur[''],
                //         valider: objFormateur['Séance EFM']

                listModulesRegionalGroupe = tableGroup.filter(e => e['Régional'] == 'O')


                // tableGroup.forEach(m => {
                //     objModuleGroupe = {
                //         nom : m.Module
                //     }
                // })

                let MHAfectGlobal = 0;
                let MHRealisGlobal = 0;

                let MHAfectGlobalS1 = 0;
                let MHRealisGlobalS1 = 0;
                let MHAfectGlobalS2 = 0;
                let MHRealisGlobalS2 = 0;

                let MHAfectGlobalS1P = 0;
                let MHRealisGlobalS1P = 0;
                let MHAfectGlobalS2P = 0;
                let MHRealisGlobalS2P = 0;

                let MHAfectGlobalS1SYN = 0;
                let MHRealisGlobalS1SYN = 0;
                let MHAfectGlobalS2SYN = 0;
                let MHRealisGlobalS2SYN = 0;
                let TauxMHRealisGlobal;
                let res;
                let listS1 = []
                let listS2 = [];


                tableGroup.forEach(elt => {



                    if ((elt["Module"] != "Culture entrepreneuriale") || (elt["Module"] == "Culture entrepreneuriale" && elt["Mle Affecté Présentiel Actif"])) {

                        MHAfectGlobal += Number(elt["MH Affectée Globale (P & SYN)"]) || (Number(elt["MH Totale  DRIF"]) - Number(elt["MHASYN Totale DRIF"]));

                    }
                    if (elt["MH Réalisée Globale"]) {

                        MHRealisGlobal += Number(elt["MH Réalisée Globale"]);

                    }
                    if ((elt["Module"] != "Culture entrepreneuriale") || (elt["Module"] == "Culture entrepreneuriale" && elt["Mle Affecté Présentiel Actif"])) {

                        if (elt['MH Totale S1 DRIF'] != 0 && elt['MH Totale S1 DRIF'] >= elt['MH Totale S2 DRIF']) {
                            listS1.push(elt)
                            if (elt["Groupe"].includes("TREMOA")) {
                                if (elt["MH Affectée Globale (P & SYN)"]) {

                                    MHAfectGlobalS1 += Number(elt["MH Affectée Globale (P & SYN)"]);
                                    MHAfectGlobalS1P += Number(elt["MH Affectée Présentiel"]) || 0;
                                    MHAfectGlobalS1SYN += Number(elt["MH Affectée Sync"]) || 0;

                                }
                                else {
                                    MHAfectGlobalS1 += Number((Number(elt["MH Totale  DRIF"]) - Number(elt["MHASYN Totale DRIF"]))) || 0;
                                    MHAfectGlobalS1P += Number(elt["MHP Totale DRIF"]) || 0;
                                    MHAfectGlobalS1SYN += Number(elt["MHSYN Totale DRIF"]) || 0;

                                }



                                MHRealisGlobalS1P += Number(elt["MH Réalisée Présentiel"]) || 0;
                                MHRealisGlobalS1 += Number(elt["MH Réalisée Globale"]) || 0;
                                MHRealisGlobalS1SYN += Number(elt["MH Réalisée Sync"]) || 0;

                            } else {

                                if (elt['MH Totale S2 DRIF'] != 0) {
                                    MHAfectGlobalS2 += Number(elt['MHP S2 DRIF'])
                                    MHAfectGlobalS2 += Number(elt['MHSYN S2 DRIF'])
                                    MHAfectGlobalS2P += Number(elt["MHP S2 DRIF"]);
                                    MHAfectGlobalS2SYN += Number(elt["MHSYN S2 DRIF"]) || 0;
                                    listS2.push(elt)
                                    let dif = Number(elt["MH Réalisée Sync"]) - Number(elt['MHSYN S1 DRIF'])

                                    if (dif > 0) {
                                        MHRealisGlobalS2 += Number(dif)
                                        MHRealisGlobalS2SYN += Number(dif)
                                        MHRealisGlobalS1 -= Number(dif)
                                        MHRealisGlobalS1SYN -= Number(dif)

                                    }
                                    let dif2 = Number(elt["MH Réalisée Présentiel"]) - Number(elt['MHP S1 DRIF'])

                                    if (dif2 > 0) {
                                        MHRealisGlobalS2 += Number(dif2)
                                        MHRealisGlobalS2P += Number(dif2)
                                        MHRealisGlobalS1 -= Number(dif2)
                                        MHRealisGlobalS1P -= Number(dif2)

                                    }



                                }
                                MHAfectGlobalS1 += Number(elt['MHP S1 DRIF'])
                                MHRealisGlobalS1 += Number(elt['MH Réalisée Présentiel']) || 0;
                                MHAfectGlobalS1 += Number(elt['MHSYN S1 DRIF'])
                                MHRealisGlobalS1 += Number(elt['MH Réalisée Sync']) || 0

                                MHAfectGlobalS1P += Number(elt['MHP S1 DRIF'])
                                MHRealisGlobalS1P += Number(elt['MH Réalisée Présentiel']) || 0;
                                MHAfectGlobalS1SYN += Number(elt['MHSYN S1 DRIF'])
                                MHRealisGlobalS1SYN += Number(elt['MH Réalisée Sync']) || 0
                            }

                        }
                        if (elt['MH Totale S2 DRIF'] != 0 && elt['MH Totale S1 DRIF'] < elt['MH Totale S2 DRIF']) {
                            listS2.push(elt)
                            if (elt["Groupe"].includes("TREMOA")) {
                                if (elt["MH Affectée Globale (P & SYN)"]) {
                                    MHAfectGlobalS2 += Number(elt["MH Affectée Globale (P & SYN)"]);
                                    MHAfectGlobalS2P += Number(elt["MH Affectée Présentiel"]) || 0;
                                    MHAfectGlobalS2SYN += Number(elt["MH Affectée Sync"]) || 0;

                                }
                                else {
                                    MHAfectGlobalS2 += Number((Number(elt["MH Totale  DRIF"]) - Number(elt["MHASYN Totale DRIF"]))) || 0;
                                    MHAfectGlobalS2P += Number(elt['MHP Totale DRIF']) || 0;
                                    MHAfectGlobalS2SYN += Number(elt['MHSYN Totale DRIF']) || 0;

                                }





                                MHRealisGlobalS2 += Number(elt["MH Réalisée Globale"]) || 0;
                                MHRealisGlobalS2P += Number(elt["MH Réalisée Présentiel"]) || 0;
                                MHRealisGlobalS2SYN += Number(elt["MH Réalisée Sync"]) || 0;
                            } else {
                                if (elt['MH Totale S1 DRIF'] != 0) {
                                    MHAfectGlobalS1 += Number(elt['MHP S1 DRIF'])
                                    MHAfectGlobalS1 += Number(elt['MHSYN S1 DRIF'])
                                    MHAfectGlobalS1P += Number(elt["MHP S1 DRIF"]);
                                    MHAfectGlobalS1SYN += Number(elt["MHSYH S1 DRIF"]) || 0;
                                    listS1.push(elt)
                                    let dif = Number(elt["MH Réalisée Sync"]) - Number(elt['MHSYN S1 DRIF'])
                                    if (dif < 0) {
                                        MHRealisGlobalS1 += Number(elt['MH Réalisée Sync'])
                                        MHRealisGlobalS1SYN += Number(elt['MH Réalisée Sync'])
                                        MHRealisGlobalS2 -= Number(elt['MH Réalisée Sync'])
                                        MHRealisGlobalS2SYN -= Number(elt['MH Réalisée Sync'])

                                    }
                                    let dif2 = Number(elt["MH Réalisée Présentiel"]) - Number(elt['MHP S1 DRIF'])
                                    if (dif2 < 0) {
                                        MHRealisGlobalS1 += Number(elt['MH Réalisée Présentiel'])
                                        MHRealisGlobalS1P += Number(elt['MH Réalisée Présentiel'])
                                        MHAfectGlobalS2 -= Number(elt['MH Réalisée Présentiel'])
                                        MHAfectGlobalS2P -= Number(elt['MH Réalisée Présentiel'])

                                    }

                                }
                                MHAfectGlobalS2 += Number(elt['MHP S2 DRIF'])
                                MHRealisGlobalS2 += Number(elt['MH Réalisée Présentiel']) || 0;
                                MHAfectGlobalS2 += Number(elt['MHSYN S2 DRIF'])
                                MHRealisGlobalS2 += Number(elt['MH Réalisée Sync']) || 0

                                MHAfectGlobalS2P += Number(elt['MHP S2 DRIF'])
                                MHRealisGlobalS2P += Number(elt['MH Réalisée Présentiel']) || 0;
                                MHAfectGlobalS2SYN += Number(elt['MHSYN S2 DRIF'])
                                MHRealisGlobalS2SYN += Number(elt['MH Réalisée Sync']) || 0
                            }
                        }
                    }




                })

                TauxMHRealisGlobal = MHRealisGlobal * 100 / MHAfectGlobal;

                res = TauxMHRealisGlobal ? TauxMHRealisGlobal : 0;

                let tr = document.createElement('tr');
                tr.innerHTML = `<tr>
                                    <td>${group}</td>
                                    <td>${MHAfectGlobal}</td>
                                    <td>${MHRealisGlobal}</td>
                                    <td>${res.toFixed(2)}%</td>
                                </tr>`;
                tr.setAttribute('name', group)




                let divParent = document.createElement('div')
                divParent.setAttribute('class', 'table-responsive-md');

                let fieldset1 = document.createElement('fieldset');
                let legend1 = document.createElement('legend');
                legend1.innerHTML = '<h5>Modules Régionaux</h5>'
                fieldset1.style = 'border:solid;padding-bottom: 20px;'
                legend1.style = 'width:fit-content;padding: 0 10px;'
                fieldset1.appendChild(legend1);

                let listModulesRegionalGroupeS1 = listModulesRegionalGroupe.filter(m => m['MH Totale S1 DRIF'] != 0 && m['MH Totale S1 DRIF'] >= m['MH Totale S2 DRIF']);
                let listModulesRegionalGroupeS2 = listModulesRegionalGroupe.filter(m => m['MH Totale S2 DRIF'] != 0 && m['MH Totale S1 DRIF'] < m['MH Totale S2 DRIF']);

                let tableGroupe = document.createElement('table');
                tableGroupe.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');

                tableGroupe.innerHTML = `
                    <tr class="bg-secondary text-light">

                        <td>N°</td>
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>MH Affectée Présentiel</td>
                        <td>MH Affectée Sync</td>
                        <td>MH Affectée Globale (P & SYN)</td>
                        <td>MH Réalisée Présentiel</td>
                        <td>MH Réalisée Sync</td>
                        <td>MH Réalisée Globale</td>
                        <td>Avancement</td>
                        <td>Réalisé</td>
                    </tr>
                    <tr class="bg-light">
                        <td colspan='11'><b>S1</b></td>
                    </tr>
                `;
                listModulesRegionalGroupeS1.sort(function (a, b) {
                    var numA = (a["Code Module"]);
                    var numB = (b["Code Module"]);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });
                listModulesRegionalGroupeS1.sort(function (a, b) {
                    var numA = (a["Formateur Affecté Présentiel Actif"]);
                    var numB = (b["Formateur Affecté Présentiel Actif"]);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });


                listModulesRegionalGroupeS1.forEach((m, i) => {

                    let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / (m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])))

                    if ((m["Module"] != "Culture entrepreneuriale") || (m["Module"] == "Culture entrepreneuriale" && m["Mle Affecté Présentiel Actif"])) {
                        tableGroupe.innerHTML += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${m['Code Module']}-${m['Module']}</td>
                            <td>${m['Formateur Affecté Présentiel Actif']}</td>
                            <td>${m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0}</td>
                            <td>${m["MH Affectée Sync"] || m["MHSYN Totale DRIF"] || 0}</td>
                            <td><b>${m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])) || 0}</b></td>
                            <td>${m["MH Réalisée Présentiel"] || Number(0).toFixed(2)}</td>
                            <td>${m["MH Réalisée Sync"] || Number(0).toFixed(2)}</td>
                            <td><b>${m["MH Réalisée Globale"] || Number(0).toFixed(2)}</b></td>
                            <td>${Avancement.toFixed(2)}%</td>
                            <td>${m['Séance EFM']}</td>
                        </tr>
                        `;
                    }
                })

                tableGroupe.innerHTML += `
                    <tr class="bg-light">
                        <td colspan='11'><b>S2</b></td>
                    </tr>
                `;
                listModulesRegionalGroupeS2.sort(function (a, b) {
                    var numA = (a["Code Module"]);
                    var numB = (b["Code Module"]);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });
                listModulesRegionalGroupeS2.sort(function (a, b) {
                    var numA = (a['Formateur Affecté Présentiel Actif']);
                    var numB = (b['Formateur Affecté Présentiel Actif']);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });


                listModulesRegionalGroupeS2.forEach((m, i) => {

                    let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / (m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])))
                    if ((m["Module"] != "Culture entrepreneuriale") || (m["Module"] == "Culture entrepreneuriale" && m["Mle Affecté Présentiel Actif"])) {
                        tableGroupe.innerHTML += `
                        <tr>                            
                            <td>${i + 1}</td>
                            <td>${m['Code Module']}-${m['Module']}</td>
                            <td>${m['Formateur Affecté Présentiel Actif']}</td>
                            <td>${m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0}</td>
                            <td>${m["MH Affectée Sync"] || m["MHSYN Totale DRIF"] || 0}</td>
                            <td><b>${m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])) || 0}</b></td>        
                            <td>${m["MH Réalisée Présentiel"] || Number(0).toFixed(2)}</td>
                            <td>${m["MH Réalisée Sync"] || Number(0).toFixed(2)}</td>
                            <td><b>${m["MH Réalisée Globale"] || Number(0).toFixed(2)}</b></td>
                            <td>${Avancement.toFixed(2)}%</td>
                            <td>${m['Séance EFM']}</td>
                        </tr>
                        `;
                    }
                })
                fieldset1.appendChild(tableGroupe);
                divParent.appendChild(fieldset1);

                let hr = document.createElement('hr')
                divParent.appendChild(hr)

                let listModulesLocauxGroupe = tableGroup.filter(e => e['Régional'] == 'N');
                let listModulesLocauxGroupeS1 = listModulesLocauxGroupe.filter(m => m['MH Totale S1 DRIF'] != 0 && m['MH Totale S1 DRIF'] >= m['MH Totale S2 DRIF']);
                let listModulesLocauxGroupeS2 = listModulesLocauxGroupe.filter(m => m['MH Totale S2 DRIF'] != 0 && m['MH Totale S1 DRIF'] < m['MH Totale S2 DRIF']);

                let fieldset2 = document.createElement('fieldset');
                let legend2 = document.createElement('legend');
                legend2.innerHTML = '<h5>Modules Locaux</h5>'
                fieldset2.style = 'border:solid;padding-bottom: 20px;'
                legend2.style = 'width:fit-content;padding: 0 10px;'
                fieldset2.appendChild(legend2);


                let tableGroupe2 = document.createElement('table');
                tableGroupe2.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');

                tableGroupe2.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>N°</td>
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>MH Affectée Présentiel</td>
                        <td>MH Affectée Sync</td>
                        <td>MH Affectée Globale (P & SYN)</td>
                        <td>MH Réalisée Présentiel</td>
                        <td>MH Réalisée Sync</td>
                        <td>MH Réalisée Globale</td>
                        <td>Avancement</td>
                        <td>Réalisé</td>
                    </tr>
                    <tr class="bg-light">
                        <td colspan='11'><b>S1</b></td>
                    </tr>
                `;
                listModulesLocauxGroupeS1.sort(function (a, b) {
                    var numA = (a["Code Module"]);
                    var numB = (b["Code Module"]);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });
                listModulesLocauxGroupeS1.sort(function (a, b) {
                    var numA = (a['Formateur Affecté Présentiel Actif']);
                    var numB = (b['Formateur Affecté Présentiel Actif']);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });


                listModulesLocauxGroupeS1.forEach((m, i) => {

                    let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / (m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])))

                    if ((m["Module"] != "Culture entrepreneuriale") || (m["Module"] == "Culture entrepreneuriale" && m["Mle Affecté Présentiel Actif"])) {
                        tableGroupe2.innerHTML += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${m['Code Module']}-${m['Module']}</td>
                            <td>${m['Formateur Affecté Présentiel Actif']}</td>
                            <td>${m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0}</td>
                            <td>${m["MH Affectée Sync"] || m["MHSYN Totale DRIF"] || 0}</td>
                            <td><b>${m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])) || 0}</b></td>
                            <td>${m["MH Réalisée Présentiel"] || Number(0).toFixed(2)}</td>
                            <td>${m["MH Réalisée Sync"] || Number(0).toFixed(2)}</td>
                            <td><b>${m["MH Réalisée Globale"] || Number(0).toFixed(2)}</b></td>
                            <td>${Avancement.toFixed(2)}%</td>
                            <td>${m['Séance EFM']}</td>
                        </tr>
                        `;
                    }
                })

                tableGroupe2.innerHTML += `
                    <tr class="bg-light">
                        <td colspan='11'><b>S2</b></td>
                    </tr>
                `;

                listModulesLocauxGroupeS2.sort(function (a, b) {
                    var numA = (a["Code Module"]);
                    var numB = (b["Code Module"]);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });
                listModulesLocauxGroupeS2.sort(function (a, b) {
                    var numA = (a['Formateur Affecté Présentiel Actif']);
                    var numB = (b['Formateur Affecté Présentiel Actif']);
                    if (numA < numB) {
                        return -1; // a comes before b
                    }

                    if (numA > numB) {
                        return 1; // a comes after b
                    }

                    return 0; // names are equal
                });
                listModulesLocauxGroupeS2.forEach((m, i) => {

                    let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / (m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])))
                    if ((m["Module"] != "Culture entrepreneuriale") || (m["Module"] == "Culture entrepreneuriale" && m["Mle Affecté Présentiel Actif"])) {
                        tableGroupe2.innerHTML += `
                        <tr>                            
                            <td>${i + 1}</td>
                            <td>${m['Code Module']}-${m['Module']}</td>
                            <td>${m['Formateur Affecté Présentiel Actif']}</td>
                            <td>${m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0}</td>
                            <td>${m["MH Affectée Sync"] || m["MHSYN Totale DRIF"] || 0}</td>
                            <td><b>${m["MH Affectée Globale (P & SYN)"] || (Number(m["MH Totale  DRIF"]) - Number(m["MHASYN Totale DRIF"])) || 0}</b></td>
                            <td>${m["MH Réalisée Présentiel"] || Number(0).toFixed(2)}</td>
                            <td>${m["MH Réalisée Sync"] || Number(0).toFixed(2)}</td>
                            <td><b>${m["MH Réalisée Globale"] || Number(0).toFixed(2)}</b></td>
                            <td>${Avancement.toFixed(2)}%</td>
                            <td>${m['Séance EFM']}</td>
                        </tr>
                        `;
                    }
                })

                fieldset2.appendChild(tableGroupe2);
                divParent.appendChild(fieldset2);

                let tableModule3 = document.createElement('table');
                tableModule3.setAttribute('class', 'table table-bordered table-hover text-center    MHCol');

                tableModule3.innerHTML = `
                <tr>
                    <td colspan='3' class="bg-secondary text-light" 
                    style="border-right:2.5px solid #dee1e6"><b>Affectée</b></td>
                    <td colspan='3' class="bg-secondary text-light"><b>Réalisée</b></td>
                    </tr>

                        
                <tr class="bg-secondary text-light ">
                           
                           <td>MH Affectée Présentiel S1</td>
                           <td>MH Affectée Sync S1</td>
                           <td style="border-right:2.5px solid #dee1e6">MH Total Affectée S1</td>
                           
                           
                           <td>MH Réalisée Présentiel S1</td>
                           <td>MH Réalisée Sync S1</td>
                           <td>MH Total Réalisée S1</td>
            
                           <td>vitesse (Heure/Semaine) </td>
                       </tr>
  
                    `;
                let vitesse = ((MHAfectGlobalS1 - MHRealisGlobalS1) / tempsRestant(new Date()))
                let min = (vitesse - Math.floor(vitesse)) * 60
                vitesse = Number(Math.floor(vitesse))
                if (min > 40) {
                    vitesse++
                }
                if (min < 40 && min >= 20) {
                    vitesse += 0.5
                }
                vitesse = (vitesse >= 0 && vitesse) || "-"
                vitesse = (new Date() < new Date("2024/01/29") && vitesse) || "-"
                tableModule3.innerHTML += `
                <tr>
                            <td>${MHAfectGlobalS1P}</td>
                            <td>${MHAfectGlobalS1SYN}</td>
                            <td style="border-right:2.5px solid #dee1e6"><b>${MHAfectGlobalS1}</b></td>
                            <td>${MHRealisGlobalS1P}</td>
                            <td>${MHRealisGlobalS1SYN}</td>
                            <td><b>${MHRealisGlobalS1}</b></td>
                                <td>${(vitesse ) }   </td>
                             
                            </tr>
                        `;

                let fieldset3 = document.createElement('fieldset');
                let legend3 = document.createElement('legend');
                legend3.innerHTML = '<h5>Details S1</h5>'
                fieldset3.style = 'border:solid;padding-bottom: 20px;'
                legend3.style = 'width:fit-content;padding: 0 10px;'
                fieldset3.appendChild(legend3);
                fieldset3.appendChild(tableModule3);
                let divButtonDet = document.createElement("div");
                divButtonDet.className = "d-flex justify-content-end mr-2";
                let buttonDet = document.createElement("button");
                buttonDet.className = "btn btn-info";
                buttonDet.innerText = "details S1"
                buttonDet.addEventListener("click", () => detailsSGr(listS1, "S1"))
                divButtonDet.append(buttonDet)
                fieldset3.append(divButtonDet)
                divParent.appendChild(fieldset3);
                let tableModule4 = document.createElement('table');
                tableModule4.setAttribute('class', 'table table-bordered table-hover text-center    MHCol');

                tableModule4.innerHTML = `
                <tr>
                    <td colspan='3' class="bg-secondary text-light" 
                    style="border-right:2.5px solid #dee1e6"><b>Affectée</b></td>
                    <td colspan='3' class="bg-secondary text-light"><b>Réalisée</b></td>
                    </tr>
                <tr class="bg-secondary text-light ">
                           
                           <td>MH Affectée Présentiel S2</td>
                           <td>MH Affectée Sync S2</td>
                           <td style="border-right:2.5px solid #dee2e6">MH Total Affectée S2</td>
                           
                           
                           <td>MH Réalisée Présentiel S2</td>
                           <td>MH Réalisée Sync S2</td>
                           <td>MH Total Réalisée S2</td>
            
                           <td>vitesse (Heure/Semaine) </td>
                       </tr>
  
                    `;
                let vitesse2 = ((MHAfectGlobalS2 - MHRealisGlobalS2) / tempsRestant(new Date()))
                let diffS1 = MHAfectGlobalS1 - MHRealisGlobalS1


                if (diffS1 > 0 && new Date() > new Date("2024/01/29")) {
                    vitesse2 = ((MHAfectGlobalS2 + (diffS1) - MHRealisGlobalS2) / tempsRestant(new Date()))
                }
                if (new Date() < new Date("2024/01/29")) {
                    vitesse2 = ((MHAfectGlobalS2 - MHRealisGlobalS2) / tempsRestant(new Date("2024/01/29")))
                }
                let min2 = (vitesse2 - Math.floor(vitesse2)) * 60
                vitesse2 = Number(Math.floor(vitesse2))
                if (min2 > 40) {
                    vitesse2++
                }
                if (min2 < 40 && min2 >= 20) {
                    vitesse2 += 0.5
                }

                if (new Date() > new Date("2024/01/29") && new Date() < new Date("2024/06/10")) {

                    tableModule4.innerHTML += `
                            <tr>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0}   ${diffS1 >= 0 && "+(" + diffS1 + " heure de S1)"}</td>
                             
                            </tr>
                            `;
                }
                else {
                    tableModule4.innerHTML += `
                            <tr>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}<b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0}   </td>
                             
                            </tr>
                            `;
                }

                let fieldset4 = document.createElement('fieldset');
                let legend4 = document.createElement('legend');
                legend4.innerHTML = '<h5>Details S2</h5>'
                fieldset4.style = 'border:solid;padding-bottom: 20px;'
                legend4.style = 'width:fit-content;padding: 0 10px;'
                fieldset4.appendChild(legend4);
                fieldset4.appendChild(tableModule4);
                let divButtonDet2 = document.createElement("div");
                divButtonDet2.className = "d-flex justify-content-end mr-2";
                let buttonDet2 = document.createElement("button");
                buttonDet2.className = "btn btn-info";
                buttonDet2.innerText = "details S2"
                buttonDet2.addEventListener("click", () => detailsSGr(listS2, "S2"))
                divButtonDet2.append(buttonDet2)
                fieldset4.append(divButtonDet2)
                divParent.appendChild(fieldset4);


                tr.onclick = () => {
                    swal({
                        title: group,
                        content: divParent,
                        buttons: [
                            'Ok',
                            'Imprimer'
                        ],
                    }).then(function (isConfirm) {
                        if (isConfirm) {
                            let imprimeD = document.createElement("div")
                            imprimeD.style.textAlign = "center"
                            imprimeD.innerHTML = `<h3 style="margin-bottom:20px">${group}</h3>`
                            imprimeD.append(divParent)
                            imprime(imprimeD, group)
                            swal({
                                title: 'Imprimer!',
                                text: `${group} imprimé avec succes!`,
                                icon: 'success'
                            })
                        };
                    });

                }

                taableG.appendChild(tr);

            })
        }

        function descOrAsc(FG, a) {
            let num = FG == 'Formateur' ? 4 : 3;
            if (a.value == 'descendant') {
                var table = document.querySelector(`#${FG} table`);
                var rows = Array.from(table.getElementsByTagName("tr")).slice(1);
                rows.sort(function (a, b) {
                    var numA = parseInt(a.cells[num].textContent);
                    var numB = parseInt(b.cells[num].textContent);

                    return numB - numA;
                });
                rows.forEach(function (row) {
                    table.tBodies[0].appendChild(row);
                });
            } else if (a.value == 'ascendant') {
                var table = document.querySelector(`#${FG} table`);
                var rows = Array.from(table.getElementsByTagName("tr")).slice(1);
                rows.sort(function (a, b) {
                    var numA = parseInt(a.cells[num].textContent);
                    var numB = parseInt(b.cells[num].textContent);
                    return numA - numB;
                });
                rows.forEach(function (row) {
                    table.tBodies[0].appendChild(row);
                });
            } else if (a.value == 'nom') {

                let num2 = FG == 'Formateur' ? 1 : 0;

                let myTable = document.querySelector(`#${FG} table`);

                sortTableByColumn(myTable, num2);

            }
        };





        ////////////////////////////////////////////////////////////////////////////

        let btnControllers = document.querySelectorAll('#btnController div');
        let tableFG = document.querySelectorAll('#Formateur, #Groupe');

        btnControllers[0].onclick = function () {

            this.classList.add('btn-success');
            this.classList.remove('btn-outline-success');
            btnControllers[1].classList.remove('btn-success');
            btnControllers[1].classList.add('btn-outline-success');



            tableFG[0].classList.remove('d-none')
            tableFG[1].classList.add('d-none')

        }

        btnControllers[1].onclick = function () {

            this.classList.add('btn-success');
            this.classList.remove('btn-outline-success');

            btnControllers[0].classList.remove('btn-success');
            btnControllers[0].classList.add('btn-outline-success');


            tableFG[1].classList.remove('d-none')
            tableFG[0].classList.add('d-none')

        }


        ////////////////////////////////////////////////////////////////////////////

        let inputFormateur = document.querySelector('#Formateur input');


        inputFormateur.oninput = inputFormateurFct;

        function inputFormateurFct() {

            let trs = document.querySelectorAll('#Formateur table tr:not(tr:only-of-type)');

            let a = inputFormateur.value;

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }


        let inputGroupe = document.querySelector('#Groupe input');


        inputGroupe.oninput = inputGroupeFct;

        function inputGroupeFct() {

            let trs = document.querySelectorAll('#Groupe table tr:not(tr:only-of-type)');

            let a = inputGroupe.value;

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        let imprimeGr = document.querySelector("#downloadGr")
        imprimeGr.addEventListener("click", function () {
            imprime(tableFG[1].querySelector('table'))
        }

        )
        let imprimeFor = document.querySelector("#downloadFor")
        imprimeFor.addEventListener("click", function () {
            imprime(tableFG[0].querySelector('table'))
        }

        )
        function imprime(tableImp, de = "") {
            document.querySelector('.main').classList.add('d-none');
            document.querySelector('.divSpiner').classList.add('d-flex');
            document.querySelector('.divSpiner').classList.remove('d-none');
            var copyTable = tableImp.cloneNode(true)

            copyTable.className = "divTableCopy"
            var elm = document.createElement("div")
            elm.innerHTML = `
            <style>
            #headBar{
                max-width: 95%;
                margin: 1px auto 50px;
                display: flex;
                align-items: center;
                text-align: center;
            }
            #headBar p{
                width: 90%;
                text-align: center;
                font-size: 20px ;
                font-family: 'Courier New', Courier, monospace;
                font-weight: bold;
            }
            #headBar img{
                width: 80px;
                height: 80px;
            }
            #date{
                text-align:end;
                margin-bottom:18px;
              color:black;
              display:block;
            }
 
            table{
                margin-top:0px;
            }
            .divTableCopy table{
                border:0.1px solid black;
                border-left:0;
                border-right:0;
                text-align:center

            }
            .divTableCopy tr:nth-of-type(even){
                background:#e7e7e769;
            }
            .divTableCopy thead tr:nth-of-type(odd){
                background:#d5d5d5;
            }
            .divTableCopy input{
                display:none;
            }
            .MHCol td:nth-of-type(3),
            .MHCol td:nth-of-type(4),
            .MHCol td:nth-of-type(5),
            .MHCol td:nth-of-type(6),
            .MHCol td:nth-of-type(7),
            .MHCol td:nth-of-type(8),
            .MHCol th:nth-of-type(3),
            .MHCol th:nth-of-type(4),
            .MHCol th:nth-of-type(5),
            .MHCol th:nth-of-type(6),
            .MHCol th:nth-of-type(7),
            .MHCol th:nth-of-type(8)
            {
                display:none;
            }
            </style>
            `
            elm.innerHTML += `
    <div id="date">${date()}</div>
    <div id="headBar">
    <p>Institut Spécialisé de Technologie Appliquée Berkane</p>
    </div>
    `



            elm.append(copyTable)
            var opt = {
                margin: 0.94,
                filename: 'AvancementBerkane/' + de + "/" + (new Date().toLocaleDateString()) + '.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            html2pdf().from(elm).set(opt).toPdf().get('pdf').then(function (pdf) {
                var totalPages = pdf.internal.getNumberOfPages();
                for (i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(10);
                    pdf.setTextColor(100);
                    pdf.text('PAGE : ' + i + '/' + totalPages, (pdf.internal.pageSize.getWidth() / 2.3), (pdf.internal.pageSize.getHeight() - 0.4));
                }


                document.querySelector('.divSpiner').classList.remove('d-flex');
                document.querySelector('.divSpiner').classList.add('d-none');
                document.querySelector('.main').classList.remove('d-none');


            }).save();
        }

        // function vide(a, i) {
        //     let inp = document.querySelector(`#${i} input`)
        //     inp.value = a.getAttribute('name')
        //     if (i == 'Formateur') {
        //         inputFormateurFct();
        //     } else {
        //         inputGroupeFct();
        //     }
        // }
        function month(a) {
            switch (a) {
                case 0:
                    return "janv";
                case 1: return "févr";
                case 2: return "mars";
                case 3: return "avril";
                case 4: return "mai";
                case 5: return "juin"
                case 6: return "juil";
                case 7: return "août";
                case 8: return "sept";
                case 9: return "oct";
                case 10: return "nov";
                case 11: return "dec";





            }
        }
        function date() {
            let data = new Date()
            return `${data.getDate()} ${month(data.getMonth())} ${data.getFullYear()}`
        }
        function sortTableByColumn(table, columnIndex) {
            var table, rows, switching, i, x, y, shouldSwitch;
            switching = true;
            while (switching) {
                switching = false;
                rows = table.rows;
                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("td")[columnIndex];
                    y = rows[i + 1].getElementsByTagName("td")[columnIndex];
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
        }
        function module5H() {
            let data = JSON.parse(localStorage.jsonData);
            let dataF = data.filter(e => {
                let pr = e["MH Affectée Présentiel"] - e["MH Réalisée Présentiel"]
                let ads = e["MH Affectée Sync"] - e["MH Réalisée Sync"]
                return ((pr <= 5 && pr > 0) || (ads == 5 && ads > 0)) && (e['Séance EFM'] == "Non")
            })
            return dataF
        }

        function afficheModule5h() {
            let data = module5H()

            data = data.sort(function (a, b) {
                var numA = (a['Formateur Affecté Présentiel Actif']).toUpperCase();
                var numB = (b['Formateur Affecté Présentiel Actif']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })

            let data1A = data.filter(m => {
                return m['Année de formation'] == 1
            })
            let data2A = data.filter(m => {
                return m['Année de formation'] == 2
            })
            let data3A = data.filter(m => {
                return m['Année de formation'] == 3
            })
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'module5H');
            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            legend1.innerHTML = '<h5>Modules presque achevés</h5>'
            fieldset1.style = 'border:solid;padding-bottom: 20px;'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            let tableGroupe = document.createElement('table');
            tableGroupe.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableGroupe.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <td>Présentiel</td>
                        <td>Sync</td>
                    </tr>
                    <tr class="bg-light annee" >
                        <td colspan='5'><b>1A</b></td>
         
                    </tr>
                  
                `;
            data1A.forEach(m => {
                let pr = (m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0) - m["MH Réalisée Présentiel"]
                let ads = (m["MH Affectée Sync"] || m['MHSYN Totale DRIF'] || 0) - m["MH Réalisée Sync"]
                // let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / m['MH Affectée Globale (P & SYN)']

                if (m['Formateur Affecté Présentiel Actif']) {
                    tableGroupe.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        <td>${pr}</td>
                        <td>${ads} </td>
                    </tr>
                    `;
                }
            })
            tableGroupe.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='5'><b>2A</b></td>
         
                    </tr>
                    `
            data2A.forEach(m => {
                let pr = (m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0) - m["MH Réalisée Présentiel"]
                let ads = (m["MH Affectée Sync"] || m['MHSYN Totale DRIF'] || 0) - m["MH Réalisée Sync"]
                // let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / m['MH Affectée Globale (P & SYN)']

                if (m['Formateur Affecté Présentiel Actif']) {
                    tableGroupe.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        <td>${pr}</td>
                        <td>${ads} </td>
                    </tr>
                    `;
                }
            })
            tableGroupe.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='5'><b>3A</b></td>
         
                    </tr>
                    `
            data3A.forEach(m => {
                let pr = (m["MH Affectée Présentiel"] || m['MHP Totale DRIF'] || 0) - m["MH Réalisée Présentiel"]
                let ads = (m["MH Affectée Sync"] || m['MHSYN Totale DRIF'] || 0) - m["MH Réalisée Sync"]
                // let Avancement = ((m['MH Réalisée Globale'] || 0) * 100) / m['MH Affectée Globale (P & SYN)']

                if (m['Formateur Affecté Présentiel Actif']) {
                    tableGroupe.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        <td>${pr}</td>
                        <td>${ads} </td>
                    </tr>
                    `;
                }
            })
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher un Formateur...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputModule5H(e)

            })
            fieldset1.appendChild(tableGroupe);
            divParent.appendChild(fieldset1);
            divParent.appendChild(input);
            swal({
                content: divParent,
                buttons: [
                    'Ok',
                    'Imprimer'
                ],
            }).then(function (isConfirm) {
                if (isConfirm) {
                    let imprimeD = document.createElement("div")
                    imprimeD.style.textAlign = "center"
                    // imprimeD.innerHTML = `<h3 style="margin-bottom:20px">Modules presque achevés</h3>`
                    imprimeD.append(divParent)
                    imprime(imprimeD, "Modules presque achevés")
                    swal({
                        title: 'Imprimer!',
                        text: `Modules presque achevés imprimé avec succes!`,
                        icon: 'success'
                    })
                };
            });
        }
        function formateurEFM() {
            let data = JSON.parse(localStorage.jsonData);
            let dataF = data.filter(e => {

                return e["Régional"] == "O"
            })
            return dataF
        }
        function afficheformateurEFM() {
            let divParent = document.createElement('div')

            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'formateurEFM');
            let data = formateurEFM()
            let formateurs = [];
            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            fieldset1.style = 'border:solid;margin-top:10px;padding-bottom: 20px;'
            legend1.innerHTML = '<h5>Formateurs ayant des EFMR</h5>'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            //  fieldset1.appendChild(tableGroupe);
            data.forEach((e) => {
                if (!formateurs.includes(e['Formateur Affecté Présentiel Actif'])) {
                    let nomForm = e['Formateur Affecté Présentiel Actif'];
                    formateurs.push(nomForm);
                }
            });
            formateurs.sort()
            let s1Formateur1A = []
            let s2Formateur1A = []
            let s1Formateur2A = []
            let s2Formateur2A = []
            let s1Formateur3A = []
            let s2Formateur3A = []
            formateurs.map((form) => {
                data.map(ele => {

                    if (ele['Formateur Affecté Présentiel Actif'] === form && ele['Formateur Affecté Présentiel Actif']) {
                        if (ele['MH Totale S1 DRIF'] != 0 && ele['MH Totale S1 DRIF'] >= ele['MH Totale S2 DRIF']) {
                            if (!s1Formateur1A.includes(ele['Formateur Affecté Présentiel Actif']) && ele["Année de formation"] == 1) {
                                let nomForm = ele['Formateur Affecté Présentiel Actif'];
                                s1Formateur1A.push(nomForm);
                            }
                            if (!s1Formateur2A.includes(ele['Formateur Affecté Présentiel Actif']) && ele["Année de formation"] == 2) {
                                let nomForm = ele['Formateur Affecté Présentiel Actif'];
                                s1Formateur2A.push(nomForm);
                            }
                            if (!s1Formateur3A.includes(ele['Formateur Affecté Présentiel Actif']) && ele["Année de formation"] == 3) {
                                let nomForm = ele['Formateur Affecté Présentiel Actif'];
                                s1Formateur3A.push(nomForm);
                            }
                        }
                        else if (ele['MH Totale S2 DRIF'] != 0 && ele['MH Totale S1 DRIF'] < ele['MH Totale S2 DRIF']) {
                            if (!s2Formateur1A.includes(ele['Formateur Affecté Présentiel Actif']) && ele["Année de formation"] == 1) {
                                let nomForm = ele['Formateur Affecté Présentiel Actif'];
                                s2Formateur1A.push(nomForm);
                            }
                            if (!s2Formateur2A.includes(ele['Formateur Affecté Présentiel Actif']) && ele["Année de formation"] == 2) {
                                let nomForm = ele['Formateur Affecté Présentiel Actif'];
                                s2Formateur2A.push(nomForm);
                            }
                            if (!s2Formateur3A.includes(ele['Formateur Affecté Présentiel Actif']) && ele["Année de formation"] == 3) {
                                let nomForm = ele['Formateur Affecté Présentiel Actif'];
                                s2Formateur3A.push(nomForm);
                            }
                        }



                    }
                })



            })
            let ul = document.createElement("ul")
            ul.style = "list-style-type:none;margin:0"
            ul.innerHTML = '<h3 class="bg-info text-white w-75 mx-auto" >S1</h3>'
            ul.innerHTML += '<h5 class="bg-secondary text-white w-75 mx-auto" >1A</h5>'

            s1Formateur1A.map((e, i) => {
                ul.innerHTML += `<li name="${e} 1A"  style="background:#ffff;margin:7px auto; display:flex;justify-content:center ">
                        <span style=" cursor: pointer;"  onclick='formDetails("${e}")'>${i + 1} - ${e}</span> </li>`


            }
            )
            ul.innerHTML += '<h5 class="bg-secondary text-white w-75 mx-auto" >2A</h5>'

            s1Formateur2A.map((e, i) => {
                ul.innerHTML += `<li name="${e} 2A"  style="background:#ffff;margin:7px auto; display:flex;justify-content:center ">
                        <span style=" cursor: pointer;"  onclick='formDetails("${e}")'>${i + 1} - ${e}</span> </li>`


            }
            )
            ul.innerHTML += '<h5 class="bg-secondary text-white w-75 mx-auto" >3A</h5>'

            s1Formateur3A.map((e, i) => {
                ul.innerHTML += `<li name="${e} 3A"  style="background:#ffff;margin:7px auto; display:flex;justify-content:center ">
                        <span style=" cursor: pointer;"  onclick='formDetails("${e}")'>${i + 1} - ${e}</span> </li>`


            }
            )

            fieldset1.append(ul)
            let ul2 = document.createElement("ul")
            ul2.style = "list-style-type:none;margin:0"
            ul2.innerHTML = '<h3 class="bg-info text-white w-75 mx-auto" >S2</h3>'
            ul2.innerHTML += '<h5 class="bg-secondary text-white w-75 mx-auto" >1A</h5>'

            s2Formateur1A.map((e, i) => {
                ul2.innerHTML += `<li name="${e} 1A" style="background:#ffff;margin:7px auto; display:flex;justify-content:center ">
                        <span style=" cursor: pointer;"   onclick='formDetails("${e}")'>${i + 1} - ${e}</span></li>`

            }
            )
            ul2.innerHTML += '<h5 class="bg-secondary text-white w-75 mx-auto" >2A</h5>'
            s2Formateur2A.map((e, i) => {
                ul2.innerHTML += `<li name="${e} 2A" style="background:#ffff;margin:7px auto; display:flex;justify-content:center ">
                        <span style=" cursor: pointer;"   onclick='formDetails("${e}")'>${i + 1} - ${e}</span></li>`

            }
            )
            ul2.innerHTML += '<h5 class="bg-secondary text-white w-75 mx-auto" >3A</h5>'
            s2Formateur3A.map((e, i) => {
                ul2.innerHTML += `<li name="${e} 3A" style="background:#ffff;margin:7px auto; display:flex;justify-content:center ">
                        <span style=" cursor: pointer;"   onclick='formDetails("${e}")'>${i + 1} - ${e}</span></li>`

            }
            )
            fieldset1.append(ul2)
            divParent.appendChild(fieldset1);

            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher un Formateur...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputFormateurFctEFM(e)

            })

            divParent.appendChild(input)



            swal({
                content: divParent,
                buttons: [
                    'Ok',
                    'Imprimer'
                ],
            }).then(function (isConfirm) {
                if (isConfirm) {
                    let imprimeD = document.createElement("div")
                    imprimeD.style.textAlign = "center"
                    // imprimeD.innerHTML = `<h3 style="margin-bottom:20px">Formateurs ayant des EFMR</h3>`
                    imprimeD.append(divParent)
                    imprime(imprimeD, "Formateurs ayant des EFMR")
                    swal({
                        title: 'Imprimer!',
                        text: `Formateurs ayant des EFMR imprimé avec succes!`,
                        icon: 'success'
                    })
                };
            });

        }
        function inputFormateurFctEFM(e) {
            const a = e.target.value;
            let trs = document.querySelectorAll('#formateurEFM li');


            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })
        }
        function formDetails(e) {
            let tr = document.querySelector("#Formateur table").querySelector(`[name="${e}"]`)
            tr.click()
        }
        function GrDetails(e) {
            let tr = document.querySelector("#Groupe table").querySelector(`[name="${e}"]`)
            tr.click()
        }
        function inputModule5H(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#module5H tr:not(tbody .annee):not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        let autreBtn = document.getElementsByClassName("autreBtn")
        autreBtn.forEach(e => {
            let divParent = document.createElement("div")
            divParent.innerHTML = `
            <span class="btn btn-info d-block  m-2"  onclick='ModulesS1Nonentames()' >Modules S1 non entamés</span>
            <span class="btn btn-info d-block  m-2"   onclick='ModulesS2Nonentames()'>Modules S2 non entamés</span>
            <span class="btn btn-success d-block  m-2"  onclick="EFMSRealisesS1()">EFMS réalisés S1</span>
            <span class="btn btn-success d-block  m-2"  onclick="EFMSRealisesS2()">EFMS réalisés S2</span>
            <span class="btn btn-primary d-block   m-2"  onclick="SynthensePr()">Synthèse Permanent</span>
            <span class="btn btn-primary d-block   m-2"  onclick="SynthenseVct()">Synthèse Vacataire</span>
            <span class="btn btn-warning d-block   m-2"  onclick="classG()">Conseils de classes</span>
            <span class="btn  btn-secondary d-block text-white  m-2"   onclick="achevesF()"> Modules achevés</span>
            `
            e.addEventListener("click", function () {

                swal({

                    content: divParent
                })
            })
        })
        function ModulesS1Nonentames() {
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'ModulesS1Nonentames');

            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            legend1.innerHTML = '<h5>Modules S1 non entamés Régionaux</h5>'
            fieldset1.style = 'border:solid;padding-bottom: 20px;'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            let data = dataModulesNonentames()
            let dataAvecFor = data.filter(m => {
                return m['Formateur Affecté Présentiel Actif']
            })
            let dataNonFor = data.filter(m => {
                return !m['Formateur Affecté Présentiel Actif']
            })
            data = dataAvecFor.sort(function (a, b) {
                var numA = (a['Formateur Affecté Présentiel Actif']).toUpperCase();
                var numB = (b['Formateur Affecté Présentiel Actif']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            dataNonFor = dataNonFor.sort(function (a, b) {
                var numA = (a['Groupe']).toUpperCase();
                var numB = (b['Groupe']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            data = [...data, ...dataNonFor]
            let dataS1 = data.filter(m => {
                return m['MH Totale S1 DRIF'] != 0 && m['MH Totale S1 DRIF'] >= m['MH Totale S2 DRIF']
            })
            let dataRegS1 = dataS1.filter(m => {
                return m['Régional'] == 'O'
            })
            let dataLocS1 = dataS1.filter(m => {
                return m['Régional'] == 'N'
            })


            let tableS1Reg = document.createElement('table');
            tableS1Reg.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS1Reg.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataRegS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataRegS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataRegS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            fieldset1.append(tableS1Reg)
            divParent.append(fieldset1)
            let fieldset2 = document.createElement('fieldset');
            let legend2 = document.createElement('legend');
            legend2.innerHTML = '<h5>Modules S1 non entamés Locaux</h5>'
            fieldset2.style = 'border:solid;padding-bottom: 20px;'
            legend2.style = 'width:fit-content;padding: 0 10px;'
            fieldset2.appendChild(legend2);
            let tableS1loc = document.createElement('table');
            tableS1loc.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS1loc.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataLocS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataLocS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataLocS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })

            fieldset2.append(tableS1loc)
            divParent.append(fieldset2)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputModuleS1Entames(e)

            })


            divParent.appendChild(input);
            swal({

                content: divParent
            })

        }
        function ModulesS2Nonentames() {
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'ModulesS2Nonentames');
            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            legend1.innerHTML = '<h5>Modules S2 non entamés Régionaux</h5>'
            fieldset1.style = 'border:solid;padding-bottom: 20px;'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            let data = dataModulesNonentames()
            let dataAvecFor = data.filter(m => {
                return m['Formateur Affecté Présentiel Actif']
            })
            let dataNonFor = data.filter(m => {
                return !m['Formateur Affecté Présentiel Actif']
            })
            data = dataAvecFor.sort(function (a, b) {
                var numA = (a['Formateur Affecté Présentiel Actif']).toUpperCase();
                var numB = (b['Formateur Affecté Présentiel Actif']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            dataNonFor = dataNonFor.sort(function (a, b) {
                var numA = (a['Groupe']).toUpperCase();
                var numB = (b['Groupe']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            data = [...data, ...dataNonFor]
            let dataS2 = data.filter(m => {
                return m['MH Totale S2 DRIF'] != 0 && m['MH Totale S1 DRIF'] < m['MH Totale S2 DRIF']
            })
            let dataRegS2 = dataS2.filter(m => {
                return m['Régional'] == 'O'
            })
            let dataLocS2 = dataS2.filter(m => {
                return m['Régional'] == 'N'
            })
            let tableS2Reg = document.createElement('table');
            tableS2Reg.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS2Reg.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataRegS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataRegS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataRegS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            fieldset1.append(tableS2Reg)
            divParent.append(fieldset1)

            let fieldset2 = document.createElement('fieldset');
            let legend2 = document.createElement('legend');
            legend2.innerHTML = '<h5>Modules S2 non entamés Locaux</h5>'
            fieldset2.style = 'border:solid;padding-bottom: 20px;'
            legend2.style = 'width:fit-content;padding: 0 10px;'
            fieldset2.appendChild(legend2);
            let tableS2loc = document.createElement('table');
            tableS2loc.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS2loc.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataLocS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataLocS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataLocS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })

            fieldset2.append(tableS2loc)
            divParent.append(fieldset2)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputModuleS2Entames(e)

            })


            divParent.appendChild(input);
            swal({

                content: divParent
            })

        }
        function EFMSRealisesS1() {
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'EFMSRealisesS1');


            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            legend1.innerHTML = '<h5>EFMS réalisés S1 Régionaux</h5>'
            fieldset1.style = 'border:solid;padding-bottom: 20px;'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            let data = dataModulesRealises()
            data = data.sort(function (a, b) {
                var numA = (a['Formateur Affecté Présentiel Actif']).toUpperCase();
                var numB = (b['Formateur Affecté Présentiel Actif']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            let dataS1 = data.filter(m => {
                return m['MH Totale S1 DRIF'] != 0 && m['MH Totale S1 DRIF'] >= m['MH Totale S2 DRIF']
            })
            let dataRegS1 = dataS1.filter(m => {
                return m['Régional'] == 'O'
            })
            let dataLocS1 = dataS1.filter(m => {
                return m['Régional'] == 'N'
            })
            let tableS1Reg = document.createElement('table');
            tableS1Reg.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS1Reg.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataRegS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataRegS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataRegS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS1Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            fieldset1.append(tableS1Reg)
            divParent.append(fieldset1)
            let fieldset2 = document.createElement('fieldset');
            let legend2 = document.createElement('legend');
            legend2.innerHTML = '<h5>EFMS réalisés S1 Locaux</h5>'
            fieldset2.style = 'border:solid;padding-bottom: 20px;'
            legend2.style = 'width:fit-content;padding: 0 10px;'
            fieldset2.appendChild(legend2);
            let tableS1loc = document.createElement('table');
            tableS1loc.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS1loc.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataLocS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataLocS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataLocS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS1loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })

            fieldset2.append(tableS1loc)
            divParent.append(fieldset2)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputEFMSRealisesS1(e)

            })


            divParent.appendChild(input);

            swal({

                content: divParent
            })

        }
        function EFMSRealisesS2() {
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'EFMSRealisesS2');

            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            legend1.innerHTML = '<h5>EFMS réalisés S2 Régionaux</h5>'
            fieldset1.style = 'border:solid;padding-bottom: 20px;'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            let data = dataModulesRealises()
            data = data.sort(function (a, b) {
                var numA = (a['Formateur Affecté Présentiel Actif']).toUpperCase();
                var numB = (b['Formateur Affecté Présentiel Actif']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })

            let dataS2 = data.filter(m => {
                return m['MH Totale S2 DRIF'] != 0 && m['MH Totale S1 DRIF'] < m['MH Totale S2 DRIF']
            })
            let dataRegS2 = dataS2.filter(m => {
                return m['Régional'] == 'O'
            })
            let dataLocS2 = dataS2.filter(m => {
                return m['Régional'] == 'N'
            })
            let tableS2Reg = document.createElement('table');
            tableS2Reg.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS2Reg.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataRegS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataRegS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2Reg.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataRegS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS2Reg.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            fieldset1.append(tableS2Reg)
            divParent.append(fieldset1)

            let fieldset2 = document.createElement('fieldset');
            let legend2 = document.createElement('legend');
            legend2.innerHTML = '<h5>EFMS réalisés S2 Locaux</h5>'
            fieldset2.style = 'border:solid;padding-bottom: 20px;'
            legend2.style = 'width:fit-content;padding: 0 10px;'
            fieldset2.appendChild(legend2);
            let tableS2loc = document.createElement('table');
            tableS2loc.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS2loc.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
                        <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    </tr>
                    
                `;
            dataLocS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 1) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 1) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A" >
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            dataLocS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 2) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 2) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2loc.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            dataLocS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif'] && m["Année de formation"] == 3) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
                        
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale" && m["Année de formation"] == 3) {
                    tableS2loc.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })

            fieldset2.append(tableS2loc)
            divParent.append(fieldset2)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputEFMSRealisesS2(e)

            })


            divParent.appendChild(input);

            swal({

                content: divParent
            })

        }
        function dataModulesNonentames() {
            let data = JSON.parse(localStorage.jsonData);
            return data.filter(e => {
                return (!e["MH Réalisée Globale"])
            })

        }
        function dataModulesAcheves() {
            let data = JSON.parse(localStorage.jsonData);
            return data.filter(e => {
                let MHRealisGlobal = e["MH Réalisée Globale"]
                let MHAfectGlobal = Number((Number(e["MH Totale  DRIF"]) - Number(e["MHASYN Totale DRIF"])))
                if (e["Groupe"].includes("TREMOA")) {
                    MHAfectGlobal = Number(e["MH Affectée Globale (P & SYN)"] || 0)

                }

                let TauxMHRealisGlobal = MHRealisGlobal * 100 / MHAfectGlobal;
                return (TauxMHRealisGlobal >= 100 && e["Séance EFM"] == "Non")
            })
        }

        function dataModulesRealises() {
            let data = JSON.parse(localStorage.jsonData);
            return data.filter(e => {
                return e["Séance EFM"] == "Oui"
            })

        }
        function inputModuleS1Entames(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#ModulesS1Nonentames tr:not(body .annee):not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function inputModulesAcheves(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#achevesF tr:not(body .annee):not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function inputModuleS2Entames(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#ModulesS2Nonentames tr:not(body .annee):not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function inputEFMSRealisesS1(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#EFMSRealisesS1 tr:not(body .annee):not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function inputEFMSRealisesS2(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#EFMSRealisesS2 tr:not(body .annee):not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function tempsRestant(dat) {

            var dateDebut = dat;
            var dateFinS1 = new Date("2024/01/29")


            var dateFinS2 = new Date("2024/06/16")
            let diffS = 0

            numbrDeSem = 0;
            let vac = [
                {
                    dateDebut: new Date("2023/12/03"),
                    dateFin: new Date("2023/12/10")
                },
                {
                    dateDebut: new Date("2024/01/21"),
                    dateFin: new Date("2024/01/28")
                },
                {
                    dateDebut: new Date("2024/03/10"),
                    dateFin: new Date("2024/03/17")
                },
                {
                    dateDebut: new Date("2024/04/28"),
                    dateFin: new Date("2024/05/05")
                }

            ]
            if (dateDebut < new Date("2024/01/29")) {
                diffS = (dateFinS1 - dateDebut)

                vac.map(e => {

                    let difD = (dateDebut - e.dateDebut) / (1000 * 60 * 60 * 24)



                    if (e.dateFin < dateFinS1 && difD < 6) {
                        numbrDeSem++;
                    }

                })
            }
            if (dateDebut >= new Date("2024/01/29")) {
                diffS = (dateFinS2 - dateDebut)
                vac.map(e => {
                    let difD = (dateDebut - e.dateDebut) / (1000 * 60 * 60 * 24)
                    if (difD < 6 && e.dateFin < dateFinS2) {

                        numbrDeSem++;
                    }
                })
            }

            let difRest = Math.ceil(Math.ceil(diffS / (1000 * 60 * 60 * 24)) / 7)


            diffS = Math.ceil((Math.ceil(diffS / (1000 * 60 * 60 * 24)) - difRest) / 6)
            // console.log(diffS);

            return diffS - numbrDeSem
        }
        //  console.log(tempsRestant(Date())); 
        // console.log((Date()));




        function detailsSFor(listS, type) {
            listS = listS.sort(function (a, b) {
                var numA = (a["Groupe"]).toUpperCase();
                var numB = (b["Groupe"]).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })

            let divParent = document.createElement("div")
            let tableModule3 = document.createElement('table');
            let listSexist = []
            tableModule3.setAttribute('class', 'table table-bordered table-hover text-center    MHCol');

            tableModule3.innerHTML = `
        <tr>
            <td colspan='2'></td>
            <td colspan='3' class="bg-secondary text-light" 
            style="border-right:2.5px solid #dee1e6"><b>Affectée</b></td>
            <td colspan='3' class="bg-secondary text-light"><b>Réalisée</b></td>
            </tr>

                
            <tr class="bg-secondary text-light ">
                
                <td>Groupe</td>
                <td>number du module</td>
                <td>MH Affectée  Présentiel </td>
                <td>MH Affectée  Sync </td>
                <td style="border-right:2.5px solid #dee1e6">MH Affectée Total  </td>
                
                
                <td>MH Réalisée Présentiel </td>
                <td>MH Réalisée Sync </td>
                <td>MH Total Réalisée </td>

                <td>vitesse (Heure/Semaine) </td>
                </tr>

            `;
            let groupeSYN = [];
            listS.map(elt => {

                let annees = [];
                let MHAfectGlobalS1 = 0;
                let MHRealisGlobalS1 = 0;
                let MHAfectGlobalS2 = 0;
                let MHRealisGlobalS2 = 0;
                let MHAfectGlobalS1P = 0;
                let MHRealisGlobalS1P = 0;
                let MHAfectGlobalS2P = 0;
                let MHRealisGlobalS2P = 0;
                let MHAfectGlobalS1SYN = 0;
                let MHRealisGlobalS1SYN = 0;
                let MHAfectGlobalS2SYN = 0;
                let MHRealisGlobalS2SYN = 0;


                if (!listSexist.includes(elt["Groupe"])) {
                    listSexist.push(elt["Groupe"])
                    let difSYN = 0
                    let data = listS.filter(e => e["Groupe"] == elt["Groupe"])


                    // console.log(data);
                    data.map(groupe => {
                        let groupeSpr = groupe.Groupe.split("")
                        let groupeStg = ""
                        for (let t of groupeSpr) {
                            if (isNaN(t)) {
                                groupeStg += t
                            }
                            else {
                                groupeStg += t
                                break;
                            }
                        }

                        let countEx = groupeSYN.filter(m => (m.grp == groupeStg && m.Module == groupe["Code Module"]))
                        //    console.log(groupe.Groupe);
                        // console.log(groupe["Code Module"]);
                        //    console.log(countEx.length)
                        // console.log(groupeSYN);


                        if (!(groupe["Groupe"].includes("TREMOA") && (groupe["Module"].includes("Compétences") ||
                            groupe["Module"].includes("Français") || groupe["Module"].includes("Anglais")))) {

                            if (countEx.length > 0) {
                                if (type == "S1") {
                                    difSYN += Number(groupe["MHSYN S1 DRIF"]) || 0
                                    let dif = Number(groupe["MH Réalisée Sync"]) - Number(groupe['MHSYN S1 DRIF'])
                                    // console.log(dif);

                                    if (dif <= 0) {
                                        difSYN -= Number(groupe['MH Réalisée Sync'])
                                    }

                                }
                                else {
                                    difSYN += Number(groupe["MHSYN S2 DRIF"]) || 0
                                    let dif = Number(groupe["MH Réalisée Sync"]) - Number(groupe['MHSYN S1 DRIF'])
                                    if (dif > 0) {
                                        difSYN -= Number(dif)
                                    }
                                }

                                let groupeSYNnew = groupeSYN.filter(e => !(e.grp == groupeStg && e.Module == groupe["Code Module"]))
                                // console.log(groupeSYNnew);
                                groupeSYN = [...groupeSYNnew]
                            }
                            else {
                                groupeSYN.push({ grp: groupeStg, Module: groupe["Code Module"] })
                            }
                        }
                        if (groupe['MH Totale S1 DRIF'] != 0 && groupe['MH Totale S1 DRIF'] >= groupe['MH Totale S2 DRIF']) {

                            if (groupe["Groupe"].includes("TREMOA")) {
                                if (groupe["MH Affectée Globale (P & SYN)"]) {
                                    MHAfectGlobalS1 += Number(groupe["MH Affectée Présentiel"]);
                                    MHAfectGlobalS1P += Number(groupe["MH Affectée Présentiel"]) || 0;

                                }
                                else {
                                    MHAfectGlobalS1P += Number(groupe["MHP Totale DRIF"]) || 0;
                                    MHAfectGlobalS1 += Number(groupe["MHP Totale DRIF"]) || 0;
                                }




                                MHRealisGlobalS1 += Number(groupe["MH Réalisée Présentiel"]) || 0;
                                MHRealisGlobalS1P += Number(groupe["MH Réalisée Présentiel"]) || 0;
                            } else {
                                if (groupe['MH Totale S2 DRIF'] != 0) {
                                    MHAfectGlobalS2 += Number(groupe['MHP S2 DRIF'])
                                    MHAfectGlobalS2P += Number(groupe['MHP S2 DRIF'])
                                    let dif2 = Number(groupe["MH Réalisée Présentiel"]) - Number(groupe['MHP S1 DRIF'])

                                    if (dif2 > 0) {
                                        MHRealisGlobalS2 += Number(dif2)
                                        MHRealisGlobalS2P += Number(dif2)
                                        MHRealisGlobalS1 -= Number(dif2)
                                        MHRealisGlobalS1P -= Number(dif2)

                                    }


                                }
                                MHAfectGlobalS1 += Number(groupe['MHP S1 DRIF'])
                                MHRealisGlobalS1 += Number(groupe['MH Réalisée Présentiel']) || 0;
                                MHAfectGlobalS1P += Number(groupe['MHP S1 DRIF'])
                                MHRealisGlobalS1P += Number(groupe['MH Réalisée Présentiel']) || 0;
                            }
                        }


                        if (groupe['MH Totale S2 DRIF'] != 0 && groupe['MH Totale S1 DRIF'] < groupe['MH Totale S2 DRIF']) {

                            if (groupe["Groupe"].includes("TREMOA")) {
                                if (groupe["MH Affectée Globale (P & SYN)"]) {
                                    MHAfectGlobalS2P += Number(groupe["MH Affectée Présentiel"]);
                                    MHAfectGlobalS2 += Number(groupe["MH Affectée Présentiel"]) || 0;


                                }
                                else {
                                    MHAfectGlobalS2P += Number(groupe["MHP Totale DRIF"]) || 0;
                                    MHAfectGlobalS2 += Number(groupe["MHP Totale DRIF"]) || 0;

                                }


                                MHRealisGlobalS2 += Number(groupe["MH Réalisée Présentiel"]) || 0;
                                MHRealisGlobalS2P += Number(groupe["MH Réalisée Présentiel"]) || 0;
                            } else {
                                MHAfectGlobalS2 += Number(groupe['MHP S2 DRIF'])
                                MHRealisGlobalS2 += Number(groupe['MH Réalisée Présentiel']) || 0;
                                MHAfectGlobalS2P += Number(groupe['MHP S2 DRIF'])
                                MHRealisGlobalS2P += Number(groupe['MH Réalisée Présentiel']) || 0;
                                if (groupe['MH Totale S1 DRIF'] != 0) {
                                    MHAfectGlobalS1 += Number(groupe['MHP S1 DRIF'])
                                    MHAfectGlobalS1P += Number(groupe['MHP S1 DRIF'])
                                    let dif2 = Number(groupe["MH Réalisée Présentiel"]) - Number(groupe['MHP S1 DRIF'])
                                    if (dif2 < 0) {
                                        MHRealisGlobalS1 += Number(groupe['MH Réalisée Présentiel'])
                                        MHRealisGlobalS1P += Number(groupe['MH Réalisée Présentiel'])
                                        MHAfectGlobalS2 -= Number(groupe['MH Réalisée Présentiel'])
                                        MHAfectGlobalS2P -= Number(groupe['MH Réalisée Présentiel'])

                                    }

                                }

                            }
                        }





                        if (groupe['MH Totale S1 DRIF'] != 0 && groupe['MH Totale S1 DRIF'] >= groupe['MH Totale S2 DRIF']) {
                            if (groupe["Groupe"].includes("TREMOA")) {
                                if (groupe["MH Affectée Globale (P & SYN)"]) {
                                    MHAfectGlobalS1SYN += Number(groupe["MH Affectée Sync"]);
                                    MHAfectGlobalS1 += Number(groupe["MH Affectée Sync"]) || 0;


                                }
                                else {
                                    MHAfectGlobalS1 += Number(groupe["MHSYN Totale DRIF"]) || 0;
                                    MHAfectGlobalS1SYN += Number(groupe["MHSYN Totale DRIF"]) || 0;
                                }


                                MHRealisGlobalS1 += Number(groupe["MH Réalisée Sync"]) || 0;
                                MHRealisGlobalS1SYN += Number(groupe["MH Réalisée Sync"]) || 0;
                            } else {

                                MHAfectGlobalS1 += Number(groupe['MHSYN S1 DRIF'])
                                MHRealisGlobalS1 += Number(groupe['MH Réalisée Sync']) || 0
                                MHAfectGlobalS1SYN += Number(groupe['MHSYN S1 DRIF'])
                                MHRealisGlobalS1SYN += Number(groupe['MH Réalisée Sync']) || 0
                                if (groupe['MH Totale S2 DRIF'] != 0) {
                                    MHAfectGlobalS2 += Number(groupe['MHSYN S2 DRIF'])
                                    MHAfectGlobalS2SYN += Number(groupe['MHSYN S2 DRIF'])
                                    let dif = Number(groupe["MH Réalisée Sync"]) - Number(groupe['MHSYN S1 DRIF'])
                                    if (dif > 0) {
                                        MHRealisGlobalS2 += Number(dif)
                                        MHRealisGlobalS2SYN += Number(dif)
                                        MHRealisGlobalS1 -= Number(dif)
                                        MHRealisGlobalS1SYN -= Number(dif)

                                    }

                                }
                            }

                        }


                        if (groupe['MH Totale S2 DRIF'] != 0 && groupe['MH Totale S1 DRIF'] < groupe['MH Totale S2 DRIF']) {
                            if (groupe["Groupe"].includes("TREMOA")) {
                                if (groupe["MH Affectée Globale (P & SYN)"]) {
                                    MHAfectGlobalS2 += Number(groupe["MH Affectée Sync"]);
                                    MHAfectGlobalS2SYN += Number(groupe["MH Affectée Sync"]) || 0;


                                }
                                else {
                                    MHAfectGlobalS2 += Number(groupe["MHSYN Totale DRIF"]) || 0;
                                    MHAfectGlobalS2SYN += Number(groupe["MHSYN Totale DRIF"]) || 0;
                                }

                                MHRealisGlobalS2SYN += Number(groupe["MH Réalisée Sync"]) || 0;
                                MHRealisGlobalS2 += Number(groupe["MH Réalisée Sync"]) || 0;
                            } else {
                                if (groupe['MH Totale S1 DRIF'] != 0) {
                                    MHAfectGlobalS1 += Number(groupe['MHSYN S1 DRIF'])
                                    MHAfectGlobalS1SYN += Number(groupe['MHSYN S1 DRIF'])
                                    let dif = Number(groupe["MH Réalisée Sync"]) - Number(groupe['MHSYN S1 DRIF'])
                                    if (dif < 0) {
                                        MHRealisGlobalS1 += Number(groupe['MH Réalisée Sync'])
                                        MHRealisGlobalS1SYN += Number(groupe['MH Réalisée Sync'])
                                        MHRealisGlobalS2 -= Number(groupe['MH Réalisée Sync'])
                                        MHRealisGlobalS2SYN -= Number(groupe['MH Réalisée Sync'])

                                    }
                                }
                                MHAfectGlobalS2 += Number(groupe['MHSYN S2 DRIF'])
                                MHRealisGlobalS2 += Number(groupe['MH Réalisée Sync']) || 0
                                MHAfectGlobalS2SYN += Number(groupe['MHSYN S2 DRIF'])
                                MHRealisGlobalS2SYN += Number(groupe['MH Réalisée Sync']) || 0

                            }

                        }



                    })
                    // console.log(groupeSYN);

                    // console.log(difSYN);
                    // console.log("--------------------");

                    if (type == "S1") {

                        let vitesse = ((MHAfectGlobalS1 - MHRealisGlobalS1 - difSYN) / tempsRestant(new Date()))
                        let min = (vitesse - Math.floor(vitesse)) * 60
                        vitesse = Number(Math.floor(vitesse))
                        if (min >= 40) {
                            vitesse++
                        }
                        if (min < 40 && min >= 20) {
                            vitesse += 0.5
                        }
                        vitesse=(vitesse >= 0  && vitesse) || "-"
                    vitesse=(new Date() <new Date("2024/01/29")  && vitesse) || "-"
                        tableModule3.innerHTML += `
                    <tr>
                        
                        <td>${elt["Groupe"]}</td>
                        <td>
                            ${data.length}</td>
                        <td>${MHAfectGlobalS1P} </td>
                        <td>${MHAfectGlobalS1SYN} </td>
                        <td style="border-right:2.5px solid #dee1e6"><b>${MHAfectGlobalS1}</b> </td>
                        
                        
                        <td>${MHRealisGlobalS1P} </td>
                        <td>${MHRealisGlobalS1SYN} </td>
                        <td><b>${MHRealisGlobalS1}</b> </td>
        
                        <td>${vitesse }  </td>
                       </tr>
    
                    `;
                    }
                    if (type == "S2") {

                        let vitesse2 = (MHAfectGlobalS2 - MHRealisGlobalS2 - difSYN) / tempsRestant(new Date())

                        if (new Date() < new Date("2024/01/29")) {
                            vitesse2 = ((MHAfectGlobalS2 - MHRealisGlobalS2 - difSYN) / tempsRestant(new Date("2024/01/29")))
                        }
                        let min2 = (vitesse2 - Math.floor(vitesse2)) * 60
                        vitesse2 = Number(Math.floor(vitesse2))
                        if (min2 > 40) {
                            vitesse2++
                        }
                        if (min2 < 40 && min2 >= 20) {
                            vitesse2 += 0.5
                        }
                        if (new Date() > new Date("2024/01/29") && new Date() < new Date("2024/06/10")) {

                            tableModule3.innerHTML += `
                            <tr>
                                <td>${elt["Groupe"]}</td>
                        <td>
                            ${data.length}</td>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0} </td>
                             
                            </tr>
                            `;
                        }
                        else {
                            tableModule3.innerHTML += `
                            <tr>
                                <td>${elt["Groupe"]}</td>
                        <td>
                            ${data.length}</td>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0}   </td>
                             
                            </tr>
                            `;
                        }
                    }

                }
            })
            let fieldset3 = document.createElement('fieldset');
            let legend3 = document.createElement('legend');
            legend3.innerHTML = `<h5>Details ${type} de formateur ${listS[0]['Formateur Affecté Présentiel Actif']}</h5>`
            fieldset3.style = 'border:solid;padding-bottom: 20px;'
            legend3.style = 'width:fit-content;padding: 0 10px;'
            fieldset3.appendChild(legend3);
            fieldset3.appendChild(tableModule3);
            divParent.appendChild(fieldset3);
            swal({

                content: divParent
            })


        }
        function detailsSGr(listS, type) {

            let divParent = document.createElement("div")
            let tableModule3 = document.createElement('table');
            let listSexist = []
            tableModule3.setAttribute('class', 'table table-bordered table-hover text-center    MHCol');

            tableModule3.innerHTML = `
        <tr>
            <td colspan='2'></td>
            <td colspan='3' class="bg-secondary text-light" 
            style="border-right:2.5px solid #dee1e6"><b>Affectée</b></td>
            <td colspan='3' class="bg-secondary text-light"><b>Réalisée</b></td>
            </tr>

                
            <tr class="bg-secondary text-light ">
                
                <td>formateur</td>
                <td>number du module</td>
                <td>MH Affectée  Présentiel </td>
                <td>MH Affectée  Sync </td>
                <td style="border-right:2.5px solid #dee1e6">MH Affectée Total  </td>
                
                
                <td>MH Réalisée Présentiel </td>
                <td>MH Réalisée Sync </td>
                <td>MH Total Réalisée </td>

                <td>vitesse (Heure/Semaine) </td>
                </tr>

            `;
            listS.map(elt => {

                let annees = [];
                let MHAfectGlobalS1 = 0;
                let MHRealisGlobalS1 = 0;
                let MHAfectGlobalS2 = 0;
                let MHRealisGlobalS2 = 0;
                let MHAfectGlobalS1P = 0;
                let MHRealisGlobalS1P = 0;
                let MHAfectGlobalS2P = 0;
                let MHRealisGlobalS2P = 0;
                let MHAfectGlobalS1SYN = 0;
                let MHRealisGlobalS1SYN = 0;
                let MHAfectGlobalS2SYN = 0;
                let MHRealisGlobalS2SYN = 0;
                if (!listSexist.includes(elt["Formateur Affecté Présentiel Actif"])) {
                    let listM = []
                    listSexist.push(elt["Formateur Affecté Présentiel Actif"])
                    let data = listS.filter(e => e["Formateur Affecté Présentiel Actif"] == elt["Formateur Affecté Présentiel Actif"])

                    data.map(groupe => {
                        if (!listM.includes(groupe["Code Module"])) {
                            listM.push(groupe["Code Module"])


                            if (groupe['MH Totale S1 DRIF'] != 0 && groupe['MH Totale S1 DRIF'] >= groupe['MH Totale S2 DRIF']) {

                                if (groupe["Groupe"].includes("TREMOA")) {
                                    if (groupe["MH Affectée Globale (P & SYN)"]) {
                                        MHAfectGlobalS1 += Number(groupe["MH Affectée Globale (P & SYN)"]);
                                        MHAfectGlobalS1SYN += Number(groupe["MH Affectée Sync"]) || 0;
                                        MHAfectGlobalS1P += Number(groupe["MH Affectée Présentiel"]) || 0;


                                    }
                                    else {
                                        MHAfectGlobalS1 += Number((Number(groupe["MH Totale  DRIF"]) - Number(groupe["MHASYN Totale DRIF"]))) || 0;
                                        MHAfectGlobalS1SYN += Number(groupe["MHSYN Totale DRIF"]) || 0;
                                        MHAfectGlobalS1P += Number(groupe["MHP Totale DRIF"]) || 0;

                                    }



                                    MHRealisGlobalS1P += Number(groupe["MH Réalisée Présentiel"]) || 0;
                                    MHRealisGlobalS1SYN += Number(groupe["MH Réalisée Sync"]) || 0;
                                    MHRealisGlobalS1 += Number(groupe["MH Réalisée Globale"]) || 0;
                                } else {

                                    if (groupe['MH Totale S2 DRIF'] != 0) {

                                        MHAfectGlobalS2 += Number(groupe['MHP S2 DRIF'])
                                        MHAfectGlobalS2 += Number(groupe['MHSYN S2 DRIF'])
                                        MHAfectGlobalS2P += Number(groupe["MHP S2 DRIF"]);
                                        MHAfectGlobalS2SYN += Number(groupe["MHSYN S2 DRIF"]) || 0;
                                        let dif = Number(groupe["MH Réalisée Sync"]) - Number(groupe['MHSYN S1 DRIF'])
                                        if (dif > 0) {
                                            MHRealisGlobalS2 += Number(dif)
                                            MHRealisGlobalS2SYN += Number(dif)
                                            MHRealisGlobalS1 -= Number(dif)
                                            MHRealisGlobalS1SYN -= Number(dif)

                                        }
                                        let dif2 = Number(groupe["MH Réalisée Présentiel"]) - Number(groupe['MHP S1 DRIF'])

                                        if (dif2 > 0) {
                                            MHRealisGlobalS2 += Number(dif2)
                                            MHRealisGlobalS2P += Number(dif2)
                                            MHRealisGlobalS1 -= Number(dif2)
                                            MHRealisGlobalS1P -= Number(dif2)

                                        }




                                    }
                                    MHAfectGlobalS1 += Number(groupe['MHP S1 DRIF'])
                                    MHRealisGlobalS1 += Number(groupe['MH Réalisée Présentiel']) || 0;
                                    MHAfectGlobalS1 += Number(groupe['MHSYN S1 DRIF'])
                                    MHRealisGlobalS1 += Number(groupe['MH Réalisée Sync']) || 0

                                    MHAfectGlobalS1P += Number(groupe['MHP S1 DRIF'])
                                    MHRealisGlobalS1P += Number(groupe['MH Réalisée Présentiel']) || 0;
                                    MHAfectGlobalS1SYN += Number(groupe['MHSYN S1 DRIF'])
                                    MHRealisGlobalS1SYN += Number(groupe['MH Réalisée Sync']) || 0
                                }

                            }
                            if (groupe['MH Totale S2 DRIF'] != 0 && groupe['MH Totale S1 DRIF'] < groupe['MH Totale S2 DRIF']) {

                                if (groupe["Groupe"].includes("TREMOA")) {
                                    if (groupe["MH Affectée Globale (P & SYN)"]) {
                                        MHAfectGlobalS2 += Number(groupe["MH Affectée Globale (P & SYN)"]);
                                        MHAfectGlobalS2P += Number(groupe["MH Affectée Présentiel"]) || 0;
                                        MHAfectGlobalS2SYN += Number(groupe["MH Affectée Sync"]) || 0;

                                    }
                                    else {
                                        MHAfectGlobalS2 += Number((Number(groupe["MH Totale  DRIF"]) - Number(groupe["MHASYN Totale DRIF"]))) || 0;
                                        MHAfectGlobalS2P += Number(groupe["MHP Totale DRIF"]) || 0;
                                        MHAfectGlobalS2SYN += Number(groupe["MHSYN Totale DRIF"]) || 0;

                                    }



                                    MHRealisGlobalS2P += Number(groupe["MH Réalisée Présentiel"]) || 0;
                                    MHRealisGlobalS2 += Number(groupe["MH Réalisée Globale"]) || 0;
                                    MHRealisGlobalS2SYN += Number(groupe["MH Réalisée Sync"]) || 0;

                                } else {
                                    if (groupe['MH Totale S1 DRIF'] != 0) {
                                        MHAfectGlobalS1 += Number(groupe['MHP S1 DRIF'])
                                        MHAfectGlobalS1 += Number(groupe['MHSYN S1 DRIF'])
                                        MHAfectGlobalS1P += Number(groupe["MHP S1 DRIF"]);
                                        MHAfectGlobalS1SYN += Number(groupe["MHSYH S1 DRIF"]) || 0;

                                        let dif = Number(groupe["MH Réalisée Sync"]) - Number(groupe['MHSYN S1 DRIF'])
                                        if (dif < 0) {
                                            MHRealisGlobalS1 += Number(groupe['MH Réalisée Sync'])
                                            MHRealisGlobalS1SYN += Number(groupe['MH Réalisée Sync'])
                                            MHRealisGlobalS2 -= Number(groupe['MH Réalisée Sync'])
                                            MHRealisGlobalS2SYN -= Number(groupe['MH Réalisée Sync'])

                                        }
                                        let dif2 = Number(groupe["MH Réalisée Présentiel"]) - Number(groupe['MHP S1 DRIF'])
                                        if (dif2 < 0) {
                                            MHRealisGlobalS1 += Number(groupe['MH Réalisée Présentiel'])
                                            MHRealisGlobalS1P += Number(groupe['MH Réalisée Présentiel'])
                                            MHAfectGlobalS2 -= Number(groupe['MH Réalisée Présentiel'])
                                            MHAfectGlobalS2P -= Number(groupe['MH Réalisée Présentiel'])

                                        }

                                    }
                                    MHAfectGlobalS2 += Number(groupe['MHP S2 DRIF'])
                                    MHRealisGlobalS2 += Number(groupe['MH Réalisée Présentiel']) || 0;
                                    MHAfectGlobalS2 += Number(groupe['MHSYN S2 DRIF'])
                                    MHRealisGlobalS2 += Number(groupe['MH Réalisée Sync']) || 0

                                    MHAfectGlobalS2P += Number(groupe['MHP S2 DRIF'])
                                    MHRealisGlobalS2P += Number(groupe['MH Réalisée Présentiel']) || 0;
                                    MHAfectGlobalS2SYN += Number(groupe['MHSYN S2 DRIF'])
                                    MHRealisGlobalS2SYN += Number(groupe['MH Réalisée Sync']) || 0
                                }
                            }


                        }
                    })


                    if (type == "S1") {

                        let vitesse = ((MHAfectGlobalS1 - MHRealisGlobalS1) / tempsRestant(new Date()))
                        let min = (vitesse - Math.floor(vitesse)) * 60
                        vitesse = Number(Math.floor(vitesse))

                        if (min >= 40) {
                            vitesse++

                        }
                        if (min < 40 && min >= 20) {

                            vitesse += 0.5
                        }
                        vitesse=(vitesse >= 0  && vitesse) || "-"
                    vitesse=(new Date() <new Date("2024/01/29")  && vitesse) || "-"

                        tableModule3.innerHTML += `
                                <tr>
                                    
                                    <td>${elt["Formateur Affecté Présentiel Actif"]}</td>
                                    <td>
                                        ${data.length}</td>
                                    <td>${MHAfectGlobalS1P} </td>
                                    <td>${MHAfectGlobalS1SYN} </td>
                                    <td style="border-right:2.5px solid #dee1e6"><b>${MHAfectGlobalS1}</b> </td>
                                    
                                    
                                    <td>${MHRealisGlobalS1P} </td>
                                    <td>${MHRealisGlobalS1SYN} </td>
                                    <td><b>${MHRealisGlobalS1}</b> </td>
                    
                                    <td>${vitesse}  </td>
                                </tr>
    
                        `;
                    }
                    if (type == "S2") {

                        let vitesse2 = (MHAfectGlobalS2 - MHRealisGlobalS2) / tempsRestant(new Date())

                        if (new Date() < new Date("2024/01/29")) {
                            vitesse2 = ((MHAfectGlobalS2 - MHRealisGlobalS2) / tempsRestant(new Date("2024/01/29")))
                        }
                        let min2 = (vitesse2 - Math.floor(vitesse2)) * 60
                        vitesse2 = Number(Math.floor(vitesse2))
                        if (min2 > 40) {
                            vitesse2++
                        }
                        if (min2 < 40 && min2 >= 20) {
                            vitesse2 += 0.5
                        }
                        if (new Date() > new Date("2024/01/29") && new Date() < new Date("2024/06/10")) {

                            tableModule3.innerHTML += `
                            <tr>
                                <td>${elt["Groupe"]}</td>
                        <td>
                            ${data.length}</td>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0} </td>
                             
                            </tr>
                            `;
                        }
                        else {
                            tableModule3.innerHTML += `
                            <tr>
                                <td>${elt["Formateur Affecté Présentiel Actif"]}</td>
                        <td>
                            ${data.length}</td>
                            <td>${MHAfectGlobalS2P}</td>
                            <td>${MHAfectGlobalS2SYN}</td>
                            <td style="border-right:2.5px solid #dee2e6"><b>${MHAfectGlobalS2}</b></td>
                            <td>${MHRealisGlobalS2P}</td>
                            <td>${MHRealisGlobalS2SYN}</td>
                            <td><b>${MHRealisGlobalS2}</b></td>
                                <td>${(vitesse2 >= 0 && vitesse2) || 0}   </td>
                             
                            </tr>
                            `;
                        }
                    }

                }

            })
            let fieldset3 = document.createElement('fieldset');
            let legend3 = document.createElement('legend');
            legend3.innerHTML = `<h5>Details ${type} de Groupe ${listS[0]['Groupe']}</h5>`
            fieldset3.style = 'border:solid;padding-bottom: 20px;'
            legend3.style = 'width:fit-content;padding: 0 10px;'
            fieldset3.appendChild(legend3);
            fieldset3.appendChild(tableModule3);
            divParent.appendChild(fieldset3);
            swal({

                content: divParent
            })


        }
        function classG() {
            let divParent = document.createElement('div')
            divParent.id = "classG"

            let groups = [];
            let jsonData = JSON.parse(localStorage.jsonData)
            jsonData.forEach((e) => {
                let groupe = ""
                let groupeSpr = e.Groupe.split("")
                for (let t of groupeSpr) {
                    if (isNaN(t)) {

                        groupe += t

                    }
                    else {
                        groupe += t
                        break;
                    }

                }


                if (!groups.includes(groupe)) {
                    groups.push(groupe);
                }
            });

            groups.sort();


            groups.map(groupe => {

                let tableGroup = jsonData.filter(elt => elt.Groupe.startsWith(groupe))
                let nbrForPrans = 0
                let nbrForVac = 0
                let totalModule = 0
                let nbrModuleReg = 0
                let nbrModuleLoc = 0
                let nbrModuleRls = 0
                let nbrModuleRlsReg = 0
                let nbrModuleRlsLoc = 0
                let listFor = []
                let listGr = []
                tableGroup.map(elt => {
                    if (!listGr.includes(elt["Groupe"])) {
                        listGr.push(elt["Groupe"]);
                    }
                    listGr.sort()


                    if (!listFor.includes(elt["Mle Affecté Présentiel Actif"]) && elt["Mle Affecté Présentiel Actif"]) {
                        listFor.push(elt["Mle Affecté Présentiel Actif"])
                        if (!isNaN(elt["Mle Affecté Présentiel Actif"])) {
                            nbrForPrans += 1
                        }
                        else {

                            nbrForVac += 1
                        }
                    }
                    if ((elt["Module"] != "Culture entrepreneuriale") || (elt["Module"] == "Culture entrepreneuriale" && elt["Mle Affecté Présentiel Actif"])) {

                        totalModule += 1
                        if (elt['Régional'] == "O") {
                            nbrModuleReg += 1
                        }
                        else {
                            nbrModuleLoc += 1
                        }
                        if (elt["Séance EFM"] == "Oui") {
                            nbrModuleRls += 1
                            if (elt['Régional'] == "O") {
                                nbrModuleRlsReg += 1
                            }
                            else {
                                nbrModuleRlsLoc += 1
                            }
                        }
                    }



                })
                let table = document.createElement("table")
                table.innerHTML = `
                        <tr class=" bg-secondary text-white" >
                         
                            <td style="border:2px solid #dee2e6"> nbr de formateurs Permanents</td>
                            <td style="border:2px solid #dee2e6"> nbr de formateurs Vacataires</td>
                            <td style="border:2px solid #dee2e6"> nbr de modules</td>
                            <td style="border:2px solid #dee2e6"> nbr de modules achevés</td>
                         
                            <td style="border:2px solid #dee2e6">  EFM régionales prévues</td>
                            <td style="border:2px solid #dee2e6">  EFM régionales réalisées</td>
                    <td style="border:2px solid #dee2e6">  EFM locales prévues</td>
                    <td style="border:2px solid #dee2e6"> EFM locales réalisées</td>
                        </tr>


                        <tr class="m-3">

                            <td class="p-3 " style="border:2px solid #dee2e6;">${nbrForPrans}</td>
                            <td class="p-3 " style="border:2px solid #dee2e6;">${nbrForVac}</td>
                            <td class="p-3 " style="border:2px solid #dee2e6;">${totalModule}</td>
                            <td class="p-3 " style="border:2px solid #dee2e6;">${nbrModuleRls}</td>
                     
                  
                      
                            <td class="p-3  " style="border:2px solid #dee2e6">${nbrModuleReg}</td>
                            <td class="p-3  " style="border:2px solid #dee2e6">${nbrModuleRlsReg}</td>
                            <td class="p-3  " style="border:2px solid #dee2e6">${nbrModuleLoc}</td>
                            <td class="p-3  " style="border:2px solid #dee2e6">${nbrModuleRlsLoc}</td>
                        
                        </tr>
                        `;
                let fieldset4 = document.createElement('fieldset');


                let legend4 = document.createElement('legend');
                legend4.innerHTML = `<h5>${listGr.join("-")}</h5>`
                fieldset4.style = 'border:solid;padding-bottom: 20px;margin:10px auto;'
                legend4.style = 'width:fit-content;padding: 0 10px;'
                fieldset4.appendChild(legend4);
                let divFex = document.createElement("div")
                fieldset4.appendChild(table);
                fieldset4.style.background = 'rgb(247 247 247)'
                fieldset4.name = (groupe)
                divParent.appendChild(fieldset4)
            }

            )
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.focus()
            input.addEventListener("input", (e) => {
                inputclassG(e)

            })
            divParent.appendChild(input);


            swal({
                title: "Conseils de classes",
                content: divParent,
            })

        }
        function inputclassG(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#classG fieldset');
            // console.log(trs);

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function achevesF() {
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'achevesF');

            let fieldset1 = document.createElement('fieldset');
            let legend1 = document.createElement('legend');
            legend1.innerHTML = '<h5>Modules S1  Modules achevés</h5>'
            fieldset1.style = 'border:solid;padding-bottom: 20px;'
            legend1.style = 'width:fit-content;padding: 0 10px;'
            fieldset1.appendChild(legend1);
            let data = dataModulesAcheves()

            data = data.sort(function (a, b) {
                var numA = (a['Formateur Affecté Présentiel Actif']).toUpperCase();
                var numB = (b['Formateur Affecté Présentiel Actif']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            let dataS1 = data.filter(m => {
                return m['MH Totale S1 DRIF'] != 0 && m['MH Totale S1 DRIF'] >= m['MH Totale S2 DRIF']
            })
            let data1AS1 = dataS1.filter(m => {
                return m['Année de formation'] == 1
            })
            let data2AS1 = dataS1.filter(m => {
                return m['Année de formation'] == 2
            })
            let data3AS1 = dataS1.filter(m => {
                return m['Année de formation'] == 3
            })


            let tableS1 = document.createElement('table');
            tableS1.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS1.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
         
                    </tr>
                    
                    <tr class="bg-light annee">
                        <td colspan='3'><b>1A</b></td>
         
                    </tr>
                    
                    
                `;
            data1AS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif']) {
                    tableS1.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
               
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale") {
                    tableS1.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            data2AS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif']) {
                    tableS1.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
               
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale") {
                    tableS1.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS1.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            data3AS1.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif']) {
                    tableS1.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
               
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale") {
                    tableS1.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            fieldset1.append(tableS1)
            divParent.append(fieldset1)









            let fieldset2 = document.createElement('fieldset');
            let legend2 = document.createElement('legend');
            legend2.innerHTML = '<h5>Modules S2  Modules achevés</h5>'
            fieldset2.style = 'border:solid;padding-bottom: 20px;'
            legend2.style = 'width:fit-content;padding: 0 10px;'
            fieldset2.appendChild(legend2);

            let dataS2 = data.filter(m => {
                return m['MH Totale S1 DRIF'] != 0 && m['MH Totale S1 DRIF'] < m['MH Totale S2 DRIF']
            })
            let data1AS2 = dataS2.filter(m => {
                return m['Année de formation'] == 1
            })
            let data2AS2 = dataS2.filter(m => {
                return m['Année de formation'] == 2
            })
            let data3AS2 = dataS2.filter(m => {
                return m['Année de formation'] == 3
            })


            let tableS2 = document.createElement('table');
            tableS2.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md');
            tableS2.innerHTML = `
                    <tr class="bg-secondary text-light">
                        <td>Nom</td>
                        <td>Formateur</td>
                        <td>Groupe</td>
         
                    </tr>
                    
                    <tr class="bg-light annee" >
                        <td colspan='3' ><b>1A</b></td>
         
                    </tr>
                    
                    
                `;
            data1AS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif']) {
                    tableS2.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A ">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
               
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale") {
                    tableS2.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 1A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>2A</b></td>
         
                    </tr>
                    `
            data2AS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif']) {
                    tableS2.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
               
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale") {
                    tableS2.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 2A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            tableS2.innerHTML += `
            <tr class="bg-light annee" >
                        <td colspan='3'><b>3A</b></td>
         
                    </tr>
                    `
            data3AS2.forEach(m => {
                if (m["Module"] == "Culture entrepreneuriale" && m['Formateur Affecté Présentiel Actif']) {
                    tableS2.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
               
            
                        </tr>
                        `;
                }

                if (m["Module"] != "Culture entrepreneuriale") {
                    tableS2.innerHTML += `
                    <tr name="${m['Formateur Affecté Présentiel Actif']} ${m['Groupe']} 3A">
                        <td>${m['Code Module']}-${m['Module']}</td>
                        <td>${m['Formateur Affecté Présentiel Actif']}</td>
                        <td>${m["Groupe"]}</td>
          
            
                        </tr>
                        `;
                }
            })
            fieldset2.append(tableS2)
            divParent.append(fieldset2)

            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputModulesAcheves(e)

            })


            divParent.appendChild(input);
            swal({

                content: divParent
            })

        }
        function dataformateurPr() {
            let data = JSON.parse(localStorage.jsonData);
            let formateurs = []
            data.forEach((e) => {
                if (e['Formateur Affecté Présentiel Actif']) {

                    if (!formateurs.includes(e['Formateur Affecté Présentiel Actif']) && !isNaN(e["Mle Affecté Présentiel Actif"])) {
                        let nomForm = e['Formateur Affecté Présentiel Actif'];
                        formateurs.push(nomForm);
                    }
                }
            });
            formateurs.sort();

            return formateurs
        }
        function SynthensePr() {
            let tableBody = []
            let tableHead = [[
                "N°",
                "Mle",
                "Formateur",
                "MHP  S1",
                "MHSYN  S1",
                "MH Globale  S1",
                "MHP  S2",
                "MHSYN  S2",
                "MH Globale  S2",
                "MHP ",
                "MHSYN ",
                "MH Globale "
            ]]
            let data = dataformateurPr()
            let jsonData = JSON.parse(localStorage.jsonData);
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'SynthensePr');
            divParent.innerHTML = `
            <div class="d-flex justify-content-end w-100">
                <span class="btn btn-success d-block w-25 my-2 "  onclick='imprimeToutTableSrv("Pr")'>imprime les tables de service Permanents </span>
                </div>           
`
            let tableModule = document.createElement('table');
            tableModule.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');
            tableModule.innerHTML = `
                    <tr >
                            <td colspan='3'></td>
                       
                    
                            <td colspan='3' class="bg-light"><b>S1</b></td>
                       
                
                            <td colspan='3' class="bg-light"><b>S2</b></td>
                       
                    
                            <td colspan='3' class="bg-light"><b>Total</b></td>
                        </tr>
                        <tr class="bg-secondary text-light">
                            <td>N°</td>
                            <td>Mle</td>
                            <td>Formateur</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                           
                        </tr>
                        `
            data.forEach((formateur, i) => {
                let objModule;
                let tableFormateur;

                tableFormateur = jsonData.filter(e => e['Formateur Affecté Présentiel Actif'] == formateur)
                let MHAfectGlobal = 0;
                let MHAfectGlobalP = 0;
                let MHAfectGlobalSYN = 0;

                let MHAfectGlobalS1 = 0;
                let MHAfectGlobalS1P = 0;
                let MHAfectGlobalS1SYN = 0;

                let MHAfectGlobalS2 = 0;
                let MHAfectGlobalS2P = 0;
                let MHAfectGlobalS2SYN = 0;

                let listS1 = []
                let listS2 = [];

                let annees = [];
                tableFormateur.forEach(objFormateur => {


                    objModule = {

                        s1: objFormateur['MH Totale S1 DRIF'],
                        s2: objFormateur['MH Totale S2 DRIF'],
                        MHAG: (objFormateur["MH Affectée Globale (P & SYN)"] || (Number(objFormateur["MH Totale  DRIF"]) - Number(objFormateur["MHASYN Totale DRIF"]))),
                        MHAP: objFormateur["MH Affectée Présentiel"] || objFormateur['MHP Totale DRIF'] || 0,
                        MHAS: objFormateur["MH Affectée Sync"] || objFormateur['MHSYN Totale DRIF'] || 0,


                    }


                    if (!annees.includes(objFormateur["Année de formation"])) {

                        annees.push(objFormateur["Année de formation"]);

                    }

                    MHAfectGlobal += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;
                    MHAfectGlobalP += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;

                    if (objFormateur["Groupe"].includes("TREMOA") && (objFormateur["Module"].includes("Compétences") ||
                        objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais"))) {

                        MHAfectGlobal += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                        MHAfectGlobalSYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                    }
                    if (objFormateur['MH Totale S1 DRIF'] != 0 && objFormateur['MH Totale S1 DRIF'] >= objFormateur['MH Totale S2 DRIF']) {
                        listS1.push(objFormateur)
                        if (objFormateur["Groupe"].includes("TREMOA")) {

                            MHAfectGlobalS1 += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;

                            MHAfectGlobalS1P += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;
                            if (objFormateur["Module"].includes("Compétences") ||
                                objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais")) {

                                MHAfectGlobalS1 += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                MHAfectGlobalS1SYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                            }
                        } else {
                            if (objFormateur['MH Totale S2 DRIF'] != 0) {
                                MHAfectGlobalS2 += Number(objFormateur['MHP S2 DRIF'])
                                MHAfectGlobalS2P += Number(objFormateur['MHP S2 DRIF'])
                                listS2.push(objFormateur)



                            }
                            MHAfectGlobalS1 += Number(objFormateur['MHP S1 DRIF'])
                            MHAfectGlobalS1P += Number(objFormateur['MHP S1 DRIF'])
                        }
                    }
                    if (objFormateur['MH Totale S2 DRIF'] != 0 && objFormateur['MH Totale S1 DRIF'] < objFormateur['MH Totale S2 DRIF']) {
                        listS2.push(objFormateur)
                        if (objFormateur["Groupe"].includes("TREMOA")) {

                            MHAfectGlobalS2 += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;

                            MHAfectGlobalS2P += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;
                            if (objFormateur["Module"].includes("Compétences") ||
                                objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais")) {

                                MHAfectGlobalS2 += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                MHAfectGlobalS2SYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                            }

                        } else {
                            MHAfectGlobalS2 += Number(objFormateur['MHP S2 DRIF'])
                            MHAfectGlobalS2P += Number(objFormateur['MHP S2 DRIF'])
                            if (objFormateur['MH Totale S1 DRIF'] != 0) {
                                MHAfectGlobalS1 += Number(objFormateur['MHP S1 DRIF'])
                                MHAfectGlobalS1P += Number(objFormateur['MHP S1 DRIF'])
                                listS1.push(objFormateur)

                            }

                        }
                    }

                })
                let modules;
                let filieres;
                let Groupes;

                annees.forEach(annee => {

                    filieres = [];

                    tableFormateur.forEach(objFormateur => {

                        if (!filieres.includes(objFormateur['Code Filière']) && objFormateur["Année de formation"] == annee) {

                            filieres.push(objFormateur['Code Filière']);

                        }

                    })

                    filieres.forEach(e => {

                        modules = [];
                        tableFormateur.forEach(m => {

                            if (!modules.includes(m['Code Module']) && m["Année de formation"] == annee && m['Code Filière'] == e) {

                                modules.push(m['Code Module']);

                            }

                        })

                        Groupes = [];
                        modules.forEach(eM => {
                            tableFormateur.forEach(eD => {

                                if (!Groupes.includes(eD['Groupe']) && eD["Année de formation"] == annee && eD['Code Filière'] == e && eD['Code Module'] == eM) {

                                    Groupes.push(eD['Groupe'])

                                }

                            })
                            Groupes.sort();
                            // console.log(annee);
                            // console.log(e);
                            // console.log(eM);
                            // console.log(Groupes);
                            Groupes.forEach((gr, index) => {

                                if (index % 2 == 0) {

                                    // console.log(gr);

                                    tableFormateur.forEach(dt => {

                                        let condTr = !(dt["Groupe"].includes("TREMOA") && (dt["Module"].includes("Compétences") ||
                                            dt["Module"].includes("Français") || dt["Module"].includes("Anglais")))

                                        if (dt['Groupe'] == gr && condTr && dt["Année de formation"] == annee && dt['Code Filière'] == e && dt['Code Module'] == eM) {
                                            // console.log(condTr);
                                            MHAfectGlobal += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                            MHAfectGlobalSYN += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                            if (dt['MH Totale S1 DRIF'] != 0 && dt['MH Totale S1 DRIF'] >= dt['MH Totale S2 DRIF']) {
                                                if (dt["Groupe"].includes("TREMOA")) {
                                                    if (dt["MH Affectée Sync"]) {
                                                        MHAfectGlobalS1 += Number(dt["MH Affectée Sync"]);
                                                        MHAfectGlobalS1SYN += Number(dt["MH Affectée Sync"]) || 0;

                                                    }
                                                    else {
                                                        MHAfectGlobalS1 += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                                        MHAfectGlobalS1SYN += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;

                                                    }


                                                } else {

                                                    MHAfectGlobalS1 += Number(dt['MHSYN S1 DRIF'])
                                                    MHAfectGlobalS1SYN += Number(dt['MHSYN S1 DRIF'])
                                                    if (dt['MH Totale S2 DRIF'] != 0) {
                                                        MHAfectGlobalS2 += Number(dt['MHSYN S2 DRIF'])
                                                        MHAfectGlobalS2SYN += Number(dt['MHSYN S2 DRIF'])


                                                    }
                                                }
                                            }
                                            if (dt['MH Totale S2 DRIF'] != 0 && dt['MH Totale S1 DRIF'] < dt['MH Totale S2 DRIF']) {
                                                if (dt["Groupe"].includes("TREMOA")) {
                                                    if (dt["MH Affectée Sync"]) {
                                                        MHAfectGlobalS2 += Number(dt["MH Affectée Sync"]);
                                                        MHAfectGlobalS2SYN += Number(dt["MH Affectée Sync"]) || 0;

                                                    }
                                                    else {
                                                        MHAfectGlobalS2 += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                        MHAfectGlobalS2SYN += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                    }


                                                } else {
                                                    if (dt['MH Totale S1 DRIF'] != 0) {
                                                        MHAfectGlobalS1 += Number(dt['MHSYN S1 DRIF'])
                                                        MHAfectGlobalS1SYN += Number(dt['MHSYN S1 DRIF'])

                                                    }
                                                    MHAfectGlobalS2 += Number(dt['MHSYN S2 DRIF'])
                                                    MHAfectGlobalS2SYN += Number(dt['MHSYN S2 DRIF'])

                                                }
                                            }

                                        }

                                    })

                                }

                            })

                        })

                    })

                })


                tableModule.innerHTML += `
                                <tr name="${tableFormateur[0]['Mle Affecté Présentiel Actif']} ${formateur}">
                                    <td>${i + 1}</td>
                                    <td>${tableFormateur[0]["Mle Affecté Présentiel Actif"]}</td>
                                    <td onclick="detailsSynt('${formateur}')" style="cursor:pointer">${formateur}</td>
                                    <td>${Number(MHAfectGlobalS1P).toFixed(2)}</td>
                                    <td>${Number(MHAfectGlobalS1SYN).toFixed(2)}</td>
                                    <td><b>${Number(MHAfectGlobalS1).toFixed(2)}</b></td>
                                    <td>${Number(MHAfectGlobalS2P).toFixed(2)}</td>
                                    <td>${Number(MHAfectGlobalS2SYN).toFixed(2)}</td>
                                    <td><b>${Number(MHAfectGlobalS2).toFixed(2)}</b></td>
                                    <td>${Number(MHAfectGlobalP).toFixed(2)}</td>
                                    <td>${Number(MHAfectGlobalSYN).toFixed(2)}</td>
                                    <td><b>${Number(MHAfectGlobal).toFixed(2)}</b></td>
                                    
                                </tr>
                                `;
                tableBody = [...tableBody, [
                    i + 1,
                    tableFormateur[0]["Mle Affecté Présentiel Actif"],
                    { content: formateur, styles: { fontStyle: 'bold' } },

                    Number(MHAfectGlobalS1P).toFixed(2),
                    Number(MHAfectGlobalS1SYN).toFixed(2),
                    { content: Number(MHAfectGlobalS1).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS2P).toFixed(2),
                    Number(MHAfectGlobalS2SYN).toFixed(2),
                    { content: Number(MHAfectGlobalS2).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalP).toFixed(2),
                    Number(MHAfectGlobalSYN).toFixed(2),
                    { content: Number(MHAfectGlobal).toFixed(2), styles: { fontStyle: 'bold' } },

                ]]
            })

            divParent.append(tableModule)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputSynthensePr(e)

            })


            divParent.appendChild(input);

            swal({
                title: "Sythènse Permanent",
                content: divParent,
                buttons: [
                    'Ok',
                    'Imprimer'
                ],
            })
                .then(function (isConfirm) {


                    if (isConfirm) {

                        // imprimeD.innerHTML = `<h3 style="margin-bottom:20px">Formateurs ayant des EFMR</h3>`
                        imprimeSyt(tableHead, tableBody, "Permanent")

                        swal({
                            title: 'Imprimer!',
                            text: `Sythènse Permanent imprimé avec succes!`,
                            icon: 'success'
                        })
                    };
                });

        }
        function inputSynthensePr(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#SynthensePr tr:not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function dataformateurVct() {
            let data = JSON.parse(localStorage.jsonData);
            let formateurs = []
            data.forEach((e) => {
                if (e['Formateur Affecté Présentiel Actif']) {

                    if (!formateurs.includes(e['Formateur Affecté Présentiel Actif']) && isNaN(e["Mle Affecté Présentiel Actif"])) {
                        let nomForm = e['Formateur Affecté Présentiel Actif'];
                        formateurs.push(nomForm);
                    }
                }
            });
            formateurs.sort();

            return formateurs
        }
        function SynthenseVct() {
            let tableBody = []
            let tableHead = [[
                "N°",
                "Mle",
                "Formateur",
                "MHP  S1",
                "MHSYN  S1",
                "MH Globale  S1",
                "MHP  S2",
                "MHSYN  S2",
                "MH Globale  S2",
                "MHP ",
                "MHSYN ",
                "MH Globale "
            ]]
            let data = dataformateurVct()
            let jsonData = JSON.parse(localStorage.jsonData);
            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'SynthenseVct');
            divParent.innerHTML = `
            <div class="d-flex justify-content-end w-100">
                <span class="btn btn-success d-block w-25 my-2 "  onclick='imprimeToutTableSrv("Vct")'>imprime les tables de service de Vacataires </span>
                </div>           
`
            let tableModule = document.createElement('table');
            tableModule.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');
            tableModule.innerHTML = `
                    <tr >
                            <td colspan='3'></td>
                       
                    
                            <td colspan='3' class="bg-light"><b>S1</b></td>
                       
                
                            <td colspan='3' class="bg-light"><b>S2</b></td>
                       
                    
                            <td colspan='3' class="bg-light"><b>Total</b></td>
                        </tr>

                        <tr class="bg-secondary text-light">
                            <td>N°</td>
                            <td>Mle</td>
                            <td>Formateur</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                           
                        </tr>
                        `
            data.forEach((formateur, i) => {
                let objModule;
                let tableFormateur;

                tableFormateur = jsonData.filter(e => e['Formateur Affecté Présentiel Actif'] == formateur)
                let MHAfectGlobal = 0;
                let MHAfectGlobalP = 0;
                let MHAfectGlobalSYN = 0;

                let MHAfectGlobalS1 = 0;
                let MHAfectGlobalS1P = 0;
                let MHAfectGlobalS1SYN = 0;

                let MHAfectGlobalS2 = 0;
                let MHAfectGlobalS2P = 0;
                let MHAfectGlobalS2SYN = 0;

                let listS1 = []
                let listS2 = [];

                let annees = [];
                tableFormateur.forEach(objFormateur => {


                    objModule = {

                        s1: objFormateur['MH Totale S1 DRIF'],
                        s2: objFormateur['MH Totale S2 DRIF'],
                        MHAG: (objFormateur["MH Affectée Globale (P & SYN)"] || (Number(objFormateur["MH Totale  DRIF"]) - Number(objFormateur["MHASYN Totale DRIF"]))),
                        MHAP: objFormateur["MH Affectée Présentiel"] || objFormateur['MHP Totale DRIF'] || 0,
                        MHAS: objFormateur["MH Affectée Sync"] || objFormateur['MHSYN Totale DRIF'] || 0,


                    }


                    if (!annees.includes(objFormateur["Année de formation"])) {

                        annees.push(objFormateur["Année de formation"]);

                    }

                    MHAfectGlobal += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;
                    MHAfectGlobalP += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;

                    if (objFormateur["Groupe"].includes("TREMOA") && (objFormateur["Module"].includes("Compétences") ||
                        objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais"))) {

                        MHAfectGlobal += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                        MHAfectGlobalSYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                    }
                    if (objFormateur['MH Totale S1 DRIF'] != 0 && objFormateur['MH Totale S1 DRIF'] >= objFormateur['MH Totale S2 DRIF']) {
                        listS1.push(objFormateur)
                        if (objFormateur["Groupe"].includes("TREMOA")) {

                            MHAfectGlobalS1 += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;

                            MHAfectGlobalS1P += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;
                            if (objFormateur["Module"].includes("Compétences") ||
                                objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais")) {

                                MHAfectGlobalS1 += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                MHAfectGlobalS1SYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                            }
                        } else {
                            if (objFormateur['MH Totale S2 DRIF'] != 0) {
                                MHAfectGlobalS2 += Number(objFormateur['MHP S2 DRIF'])
                                MHAfectGlobalS2P += Number(objFormateur['MHP S2 DRIF'])
                                listS2.push(objFormateur)



                            }
                            MHAfectGlobalS1 += Number(objFormateur['MHP S1 DRIF'])
                            MHAfectGlobalS1P += Number(objFormateur['MHP S1 DRIF'])
                        }
                    }
                    if (objFormateur['MH Totale S2 DRIF'] != 0 && objFormateur['MH Totale S1 DRIF'] < objFormateur['MH Totale S2 DRIF']) {
                        listS2.push(objFormateur)
                        if (objFormateur["Groupe"].includes("TREMOA")) {

                            MHAfectGlobalS2 += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;

                            MHAfectGlobalS2P += Number(objFormateur["MH Affectée Présentiel"]) || Number(objFormateur["MHP Totale DRIF"]) || 0;
                            if (objFormateur["Module"].includes("Compétences") ||
                                objFormateur["Module"].includes("Français") || objFormateur["Module"].includes("Anglais")) {

                                MHAfectGlobalS2 += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;
                                MHAfectGlobalS2SYN += Number(objFormateur["MH Affectée Sync"]) || Number(objFormateur["MHSYN Totale DRIF"]) || 0;


                            }

                        } else {
                            MHAfectGlobalS2 += Number(objFormateur['MHP S2 DRIF'])
                            MHAfectGlobalS2P += Number(objFormateur['MHP S2 DRIF'])
                            if (objFormateur['MH Totale S1 DRIF'] != 0) {
                                MHAfectGlobalS1 += Number(objFormateur['MHP S1 DRIF'])
                                MHAfectGlobalS1P += Number(objFormateur['MHP S1 DRIF'])
                                listS1.push(objFormateur)

                            }

                        }
                    }

                })
                let modules;
                let filieres;
                let Groupes;

                annees.forEach(annee => {

                    filieres = [];

                    tableFormateur.forEach(objFormateur => {

                        if (!filieres.includes(objFormateur['Code Filière']) && objFormateur["Année de formation"] == annee) {

                            filieres.push(objFormateur['Code Filière']);

                        }

                    })

                    filieres.forEach(e => {

                        modules = [];
                        tableFormateur.forEach(m => {

                            if (!modules.includes(m['Code Module']) && m["Année de formation"] == annee && m['Code Filière'] == e) {

                                modules.push(m['Code Module']);

                            }

                        })

                        Groupes = [];
                        modules.forEach(eM => {
                            tableFormateur.forEach(eD => {

                                if (!Groupes.includes(eD['Groupe']) && eD["Année de formation"] == annee && eD['Code Filière'] == e && eD['Code Module'] == eM) {

                                    Groupes.push(eD['Groupe'])

                                }

                            })
                            Groupes.sort();
                            // console.log(annee);
                            // console.log(e);
                            // console.log(eM);
                            // console.log(Groupes);
                            Groupes.forEach((gr, index) => {

                                if (index % 2 == 0) {

                                    // console.log(gr);

                                    tableFormateur.forEach(dt => {

                                        let condTr = !(dt["Groupe"].includes("TREMOA") && (dt["Module"].includes("Compétences") ||
                                            dt["Module"].includes("Français") || dt["Module"].includes("Anglais")))

                                        if (dt['Groupe'] == gr && condTr && dt["Année de formation"] == annee && dt['Code Filière'] == e && dt['Code Module'] == eM) {
                                            // console.log(condTr);
                                            MHAfectGlobal += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                            MHAfectGlobalSYN += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                            if (dt['MH Totale S1 DRIF'] != 0 && dt['MH Totale S1 DRIF'] >= dt['MH Totale S2 DRIF']) {
                                                if (dt["Groupe"].includes("TREMOA")) {
                                                    if (dt["MH Affectée Sync"]) {
                                                        MHAfectGlobalS1 += Number(dt["MH Affectée Sync"]);
                                                        MHAfectGlobalS1SYN += Number(dt["MH Affectée Sync"]) || 0;

                                                    }
                                                    else {
                                                        MHAfectGlobalS1 += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;
                                                        MHAfectGlobalS1SYN += Number(dt["MH Affectée Sync"]) || Number(dt["MHSYN Totale DRIF"]) || 0;

                                                    }


                                                } else {

                                                    MHAfectGlobalS1 += Number(dt['MHSYN S1 DRIF'])
                                                    MHAfectGlobalS1SYN += Number(dt['MHSYN S1 DRIF'])
                                                    if (dt['MH Totale S2 DRIF'] != 0) {
                                                        MHAfectGlobalS2 += Number(dt['MHSYN S2 DRIF'])
                                                        MHAfectGlobalS2SYN += Number(dt['MHSYN S2 DRIF'])


                                                    }
                                                }
                                            }
                                            if (dt['MH Totale S2 DRIF'] != 0 && dt['MH Totale S1 DRIF'] < dt['MH Totale S2 DRIF']) {
                                                if (dt["Groupe"].includes("TREMOA")) {
                                                    if (dt["MH Affectée Sync"]) {
                                                        MHAfectGlobalS2 += Number(dt["MH Affectée Sync"]);
                                                        MHAfectGlobalS2SYN += Number(dt["MH Affectée Sync"]) || 0;

                                                    }
                                                    else {
                                                        MHAfectGlobalS2 += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                        MHAfectGlobalS2SYN += Number(dt["MHSYN Totale DRIF"]) || 0;
                                                    }


                                                } else {
                                                    if (dt['MH Totale S1 DRIF'] != 0) {
                                                        MHAfectGlobalS1 += Number(dt['MHSYN S1 DRIF'])
                                                        MHAfectGlobalS1SYN += Number(dt['MHSYN S1 DRIF'])

                                                    }
                                                    MHAfectGlobalS2 += Number(dt['MHSYN S2 DRIF'])
                                                    MHAfectGlobalS2SYN += Number(dt['MHSYN S2 DRIF'])

                                                }
                                            }

                                        }

                                    })

                                }

                            })

                        })

                    })

                })


                tableModule.innerHTML += `
                                <tr name="${tableFormateur[0]['Mle Affecté Présentiel Actif']} ${formateur}">
                                    <td>${i + 1}</td>
                                    <td>${tableFormateur[0]["Mle Affecté Présentiel Actif"]}</td>
                                    <td onclick="detailsSynt('${formateur}')" style="cursor:pointer">${formateur}</td>
                                    <td>${Number(MHAfectGlobalS1P).toFixed(2)}</td>
                                    <td>${Number(MHAfectGlobalS1SYN).toFixed(2)}</td>
                                    <td><b>${Number(MHAfectGlobalS1).toFixed(2)}</b></td>
                                    <td>${Number(MHAfectGlobalS2P).toFixed(2)}</td>
                                    <td>${Number(MHAfectGlobalS2SYN).toFixed(2)}</td>
                                    <td><b>${Number(MHAfectGlobalS2).toFixed(2)}</b></td>
                                    <td>${Number(MHAfectGlobalP).toFixed(2)}</td>
                                    <td>${Number(MHAfectGlobalSYN).toFixed(2)}</td>
                                    <td><b>${Number(MHAfectGlobal).toFixed(2)}</b></td>
                                    
                                </tr>
                                `;
                tableBody = [...tableBody, [
                    i + 1,
                    tableFormateur[0]["Mle Affecté Présentiel Actif"],
                    { content: formateur, styles: { fontStyle: 'bold' } },

                    Number(MHAfectGlobalS1P).toFixed(2),
                    Number(MHAfectGlobalS1SYN).toFixed(2),
                    { content: Number(MHAfectGlobalS1).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS2P).toFixed(2),
                    Number(MHAfectGlobalS2SYN).toFixed(2),
                    { content: Number(MHAfectGlobalS2).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalP).toFixed(2),
                    Number(MHAfectGlobalSYN).toFixed(2),
                    { content: Number(MHAfectGlobal).toFixed(2), styles: { fontStyle: 'bold' } },

                ]]
            })
            divParent.append(tableModule)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputSynthenseVct(e)

            })


            divParent.appendChild(input);

            swal({
                title: "Sythènse Vacataire",
                content: divParent,
                buttons: [
                    'Ok',
                    'Imprimer'
                ],
            }).then(function (isConfirm) {


                if (isConfirm) {

                    // imprimeD.innerHTML = `<h3 style="margin-bottom:20px">Formateurs ayant des EFMR</h3>`
                    imprimeSyt(tableHead, tableBody, "Vacataire")

                    swal({
                        title: 'Imprimer!',
                        text: `Sythènse Vacataire imprimé avec succes!`,
                        icon: 'success'
                    })
                };
            });

        }
        function inputSynthenseVct(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#SynthenseVct tr:not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function imprimeSyt(tableHead, tableBody, type) {

            setTimeout(() => {
                const jsPDF = new window.jspdf.jsPDF();
                let logo = "https://upload.wikimedia.org/wikipedia/commons/0/05/Logo_ofppt.png";

                const generatePDF = () => {
                    const pdf = new window.jspdf.jsPDF({
                        format: 'a4',
                        orientation: 'landscape',
                    });

                    const img = new Image();
                    img.src = logo;
                    const currentDate = new Date().toLocaleDateString();
                    img.onload = function () {
                        pdf.addImage(this, 'PNG', 10, 5, 25, 25);

                        pdf.setFontSize(10);
                        pdf.text('Institut Spécialisé de Technologie Appliquée - Berkane', 195, 20);
                        pdf.text(currentDate, 270, 5);
                        pdf.setFontSize(17);
                        pdf.text('Sythènse ' + type, 120, 35);

                        pdf.setFontSize(10);
                        pdf.text('Direction: DR Oriental', 15, 45);
                        pdf.text('Complexe: CF Berkane', 15, 50);
                        pdf.text('Année de formation: 2023-2024', 230, 50);

                        // بداية الجدول
                        pdf.autoTable({
                            head: tableHead,
                            body: tableBody,
                            startY: 57,
                            headStyles: { align: 'center' },
                            bodyStyles: { align: 'center' },
                        });

                        pdf.save("Sythènse_" + type + "_" + (new Date().toLocaleDateString()) + '.pdf');
                    };
                };

                generatePDF();
            }, 500);
        };

        function dataDetailsSynt(formateur) {
            let jsonData = JSON.parse(localStorage.jsonData);
            let data = jsonData.filter(e => e['Formateur Affecté Présentiel Actif'] == formateur)
            data = data.sort(function (a, b) {
                var numA = (a['Groupe']).toUpperCase();
                var numB = (b['Groupe']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })
            data = data.sort(function (a, b) {
                var numA = (a['Code Module']).toUpperCase();
                var numB = (b['Code Module']).toUpperCase();
                if (numA < numB) {
                    return -1; // a comes before b
                }

                if (numA > numB) {
                    return 1; // a comes after b
                }

                return 0; // names are equal
            })

            return data
        }
        function detailsSynt(formateur) {
            let tableBody = []
            let tableHead = [[
                "N°",
                "Groupe",
                "Module",
                "MHP  S1",
                "MHSYN  S1",
                "MH Globale  S1",
                "MHP  S2",
                "MHSYN  S2",
                "MH Globale  S2",
                "MHP ",
                "MHSYN ",
                "MH Globale "
            ]]
            let tableBody2 = []
            let tableHead2 = [[
                "",
                "MH Affectée Présentiel ",
                "MH Affectée Sync ",
                "MH Affectée Globale (P & SYN)"
            ]]
            let data = dataDetailsSynt(formateur)

            let divParent = document.createElement('div')
            divParent.setAttribute('class', 'table-responsive-md');
            divParent.setAttribute('id', 'detailsSynt');
            let tableModule = document.createElement('table');
            tableModule.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');
            tableModule.innerHTML = `
                    <tr >
                            <td colspan='3'></td>
                       
                    
                            <td colspan='3' class="bg-light"><b>S1</b></td>
                       
                
                            <td colspan='3' class="bg-light"><b>S2</b></td>
                       
                    
                            <td colspan='3' class="bg-light"><b>Total</b></td>
                        </tr>
                        <tr class="bg-secondary text-light">
                            <td>N°</td>
                            <td>Groupe</td>
                            <td>Module</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                           
                        </tr>
                        `
            let MHAfectGlobal = 0;
            let MHAfectGlobalP = 0;
            let MHAfectGlobalSYN = 0;

            let MHAfectGlobalS1 = 0;
            let MHAfectGlobalS1P = 0;
            let MHAfectGlobalS1SYN = 0;

            let MHAfectGlobalS2 = 0;
            let MHAfectGlobalS2P = 0;
            let MHAfectGlobalS2SYN = 0;

            let groupeSYN = [];

            data.map((module, i) => {
                let MHAfectGlobalModule = 0;
                let MHAfectGlobalPModule = 0;
                let MHAfectGlobalSYNModule = 0;

                let MHAfectGlobalS1Module = 0;
                let MHAfectGlobalS1PModule = 0;
                let MHAfectGlobalS1SYNModule = 0;

                let MHAfectGlobalS2Module = 0;
                let MHAfectGlobalS2PModule = 0;
                let MHAfectGlobalS2SYNModule = 0;
                let difSYN = 0
                let groupe = ""
                let groupeSpr = module.Groupe.split("")
                for (let t of groupeSpr) {
                    if (isNaN(t)) {

                        groupe += t

                    }
                    else {
                        groupe += t
                        break;
                    }

                }
                let countEx = groupeSYN.filter(m => (m.grp == groupe && m.Module == module["Code Module"]))

                if (!(module["Groupe"].includes("TREMOA") && (module["Module"].includes("Compétences") ||
                    module["Module"].includes("Français") || module["Module"].includes("Anglais")))) {

                    if (countEx.length > 0) {
                        if (!(module["Groupe"].includes("TREMOA"))) {

                            MHAfectGlobalModule = Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalPModule = Number(module["MHP Totale DRIF"]);


                            MHAfectGlobalS1Module = Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1PModule = Number(module["MHP S1 DRIF"]);

                            MHAfectGlobalS2Module = Number(module["MHP S2 DRIF"])
                            MHAfectGlobalS2PModule = Number(module["MHP S2 DRIF"]);

                            MHAfectGlobal += Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalP += Number(module["MHP Totale DRIF"]);


                            MHAfectGlobalS1 += Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1P += Number(module["MHP S1 DRIF"]);


                            MHAfectGlobalS2 += Number(module["MHP S2 DRIF"])
                            MHAfectGlobalS2P += Number(module["MHP S2 DRIF"]);

                        }
                        else {
                            if (module['MH Totale S1 DRIF'] != 0 && module['MH Totale S1 DRIF'] >= module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS1Module += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS1 += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                            }
                            if (module['MH Totale S2 DRIF'] != 0 && module['MH Totale S1 DRIF'] < module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS2Module += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS2 += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                            }
                        }


                        let groupeSYNnew = groupeSYN.filter(e => !(e.grp == groupe && e.Module == module["Code Module"]))

                        groupeSYN = [...groupeSYNnew]
                    }
                    else {
                        groupeSYN.push({ grp: groupe, Module: module["Code Module"] })
                        if (!(module["Groupe"].includes("TREMOA"))) {

                            MHAfectGlobalModule = Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                            MHAfectGlobalPModule = Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalSYNModule = Number(module["MHSYN Totale DRIF"]);

                            MHAfectGlobalS1Module = Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                            MHAfectGlobalS1PModule = Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1SYNModule = Number(module["MHSYN S1 DRIF"]);

                            MHAfectGlobalS2Module = Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                            MHAfectGlobalS2PModule = Number(module["MHP S2 DRIF"]);
                            MHAfectGlobalS2SYNModule = Number(module["MHSYN S2 DRIF"]);

                            MHAfectGlobal += Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                            MHAfectGlobalP += Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalSYN += Number(module["MHSYN Totale DRIF"]);

                            MHAfectGlobalS1 += Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                            MHAfectGlobalS1P += Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1SYN += Number(module["MHSYN S1 DRIF"]);

                            MHAfectGlobalS2 += Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                            MHAfectGlobalS2P += Number(module["MHP S2 DRIF"]);
                            MHAfectGlobalS2SYN += Number(module["MHSYN S2 DRIF"]);
                        }
                        else {
                            if (module['MH Totale S1 DRIF'] != 0 && module['MH Totale S1 DRIF'] >= module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS1Module += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS1PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1SYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS1 += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS1P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1SYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);
                            }
                            if (module['MH Totale S2 DRIF'] != 0 && module['MH Totale S1 DRIF'] < module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS2Module += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS2PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2SYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS2 += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS2P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2SYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);
                            }
                        }
                    }
                }
                else {
                    MHAfectGlobalModule = Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                    MHAfectGlobalPModule = Number(module["MHP Totale DRIF"]);
                    MHAfectGlobalSYNModule = Number(module["MHSYN Totale DRIF"]);

                    MHAfectGlobalS1Module = Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                    MHAfectGlobalS1PModule = Number(module["MHP S1 DRIF"]);
                    MHAfectGlobalS1SYNModule = Number(module["MHSYN S1 DRIF"]);

                    MHAfectGlobalS2Module = Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                    MHAfectGlobalS2PModule = Number(module["MHP S2 DRIF"]);
                    MHAfectGlobalS2SYNModule = Number(module["MHSYN S2 DRIF"]);
                    MHAfectGlobal += Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                    MHAfectGlobalP += Number(module["MHP Totale DRIF"]);
                    MHAfectGlobalSYN += Number(module["MHSYN Totale DRIF"]);

                    MHAfectGlobalS1 += Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                    MHAfectGlobalS1P += Number(module["MHP S1 DRIF"]);
                    MHAfectGlobalS1SYN += Number(module["MHSYN S1 DRIF"]);

                    MHAfectGlobalS2 += Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                    MHAfectGlobalS2P += Number(module["MHP S2 DRIF"]);
                    MHAfectGlobalS2SYN += Number(module["MHSYN S2 DRIF"]);
                }

                tableModule.innerHTML += `
                                <tr name=" ${module['Groupe']}">
                                    <td>${i + 1}</td>
                                    <td>${module["Groupe"]}</td>
                                    <td >${module['Code Module']}-${module['Module']}</td>
                                   
                                    <td>${MHAfectGlobalS1PModule.toFixed(2)}</td>
                                    <td>${MHAfectGlobalS1SYNModule.toFixed(2)}</td>
                                    <td><b>${MHAfectGlobalS1Module.toFixed(2)}</b></td>
                                    <td>${MHAfectGlobalS2PModule.toFixed(2)}</td>
                                    <td>${MHAfectGlobalS2SYNModule.toFixed(2)}</td>
                                    <td><b>${MHAfectGlobalS2Module.toFixed(2)}</b></td>
                                    <td>${MHAfectGlobalPModule.toFixed(2)}</td>
                                    <td>${MHAfectGlobalSYNModule.toFixed(2)}</td>
                                    <td><b>${MHAfectGlobalModule.toFixed(2)}</b></td>
                                    
                                </tr>
                                `;
                tableBody = [...tableBody, [
                    i + 1,
                    module["Groupe"],
                    `${module['Code Module']}-${module['Module']}`,
                    Number(MHAfectGlobalS1PModule).toFixed(2),
                    Number(MHAfectGlobalS1SYNModule).toFixed(2),
                    { content: Number(MHAfectGlobalS1Module).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS2PModule).toFixed(2),
                    Number(MHAfectGlobalS2SYNModule).toFixed(2),
                    { content: Number(MHAfectGlobalS2Module).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalPModule).toFixed(2),
                    Number(MHAfectGlobalSYNModule).toFixed(2),
                    { content: Number(MHAfectGlobalModule).toFixed(2), styles: { fontStyle: 'bold' } }
                ]]
            })



            let tableModuleTotal = document.createElement('table');
            tableModuleTotal.setAttribute('class', 'table table-bordered table-hover text-center table-responsive-md MHCol');
            tableModuleTotal.innerHTML = `
                  
                        <tr class="bg-secondary text-light">
                           
                            <td></td>
                            <td>MH Affectée Présentiel</td>
                            <td>MH Affectée Sync</td>
                            <td>MH Affectée Globale (P & SYN)</td>
                            
                           
                        </tr>
                        <tr >
                           
                            <td><b>Total S1</b></td>
                            <td>${Number(MHAfectGlobalS1P).toFixed(2)}</td>
                            <td>${Number(MHAfectGlobalS1SYN).toFixed(2)}</td>
                            <td><b>${Number(MHAfectGlobalS1).toFixed(2)}</b></td>
                            
                           
                        </tr>
                        <tr >
                           
                            <td><b>Total S2</b></td>
                            <td>${Number(MHAfectGlobalS2P).toFixed(2)}</td>
                            <td>${Number(MHAfectGlobalS2SYN).toFixed(2)}</td>
                            <td><b>${Number(MHAfectGlobalS2).toFixed(2)}</b></td>
                            
                           
                        </tr>
                        <tr >
                           
                            <td><b> total d'annee</b></td>
                            <td>${Number(MHAfectGlobalP).toFixed(2)}</td>
                            <td>${Number(MHAfectGlobalSYN).toFixed(2)}</td>
                            <td><b>${Number(MHAfectGlobal).toFixed(2)}</b></td>
                            
                           
                        </tr>

                        `
            tableBody2 = [
                [
                    { content: " total S1", styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS1P).toFixed(2),
                    Number(MHAfectGlobalS1SYN).toFixed(2),

                    { content: Number(MHAfectGlobalS1).toFixed(2), styles: { fontStyle: 'bold' } },

                ],
                [
                    { content: " total S2", styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS2P).toFixed(2),
                    Number(MHAfectGlobalS2SYN).toFixed(2),

                    { content: Number(MHAfectGlobalS2).toFixed(2), styles: { fontStyle: 'bold' } },
                ],
                [
                    { content: " total d'annee", styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalP).toFixed(2),
                    Number(MHAfectGlobalSYN).toFixed(2),

                    { content: Number(MHAfectGlobal).toFixed(2), styles: { fontStyle: 'bold' } },

                ]
            ];


            divParent.append(tableModule)
            let input = document.createElement("input")
            input.type = 'search'
            input.placeholder = 'Rechercher ...'
            input.className = 'rechercher form-control mx-auto my-5 w-75'
            input.addEventListener("input", (e) => {
                inputDetailsSynt(e)

            })


            // divParent.appendChild(input);
            divParent.append(tableModuleTotal)

            swal({
                title: "Tableau de service : " + formateur,
                content: divParent,
                buttons: [
                    'Ok',
                    'Imprimer'
                ],
            })
                .then(function (isConfirm) {
                    console.log(isConfirm);

                    if (isConfirm) {

                        // imprimeD.innerHTML = `<h3 style="margin-bottom:20px">Formateurs ayant des EFMR</h3>`
                        imprimeSrv(tableHead, tableBody, tableHead2, tableBody2, formateur, data[0]["Mle Affecté Présentiel Actif"])

                        swal({
                            title: 'Imprimer!',
                            text: `Tableau de service (${formateur}) imprimé avec succes!`,
                            icon: 'success'
                        })
                    }

                });
        }
        function imprimeSrv(tableHead, tableBody, tableHead2, tableBody2, formateur, Mle) {
            setTimeout(() => {
                const jsPDF = new window.jspdf.jsPDF();
                let logo = "https://upload.wikimedia.org/wikipedia/commons/0/05/Logo_ofppt.png";

                const generatePDF = () => {
                    const currentDate = new Date().toLocaleDateString();

                    const pdf = new window.jspdf.jsPDF({
                        format: 'a4',
                        orientation: 'landscape',
                    });

                    const img = new Image();
                    img.src = logo;
                    img.onload = function () {
                        pdf.addImage(this, 'PNG', 10, 5, 25, 25);

                        pdf.setFontSize(10);
                        pdf.text(currentDate, 270, 5);

                        pdf.text('Institut Spécialisé de Technologie Appliquée - Berkane', 195, 20);

                        pdf.setFontSize(14);
                        pdf.text('Tableau de service ', 120, 33);

                        pdf.setFontSize(10);
                        pdf.text('Direction: DR Oriental', 15, 45);
                        pdf.text('Complexe: CF Berkane', 15, 50);
                        pdf.text('Formateur: ' + formateur, 120, 45);
                        pdf.text('Matricule: ' + Mle, 120, 50);
                        pdf.text('Année de formation: 2023-2024', 230, 50);

                        // بداية الجدول
                        pdf.autoTable({
                            head: tableHead,
                            body: tableBody,
                            startY: 57,
                            headStyles: { align: 'center' },
                            bodyStyles: { align: 'center' },
                        });
                        pdf.autoTable({
                            head: tableHead2,
                            body: tableBody2,
                            headStyles: { fillColor: [0, 128, 0], align: 'center' },
                            bodyStyles: { align: 'center' },


                        });

                        pdf.save("Tableau_de_service_" + formateur + "_" + (new Date().toLocaleDateString()) + '.pdf');
                    };
                };

                generatePDF();
            }, 500);
        }
        function inputDetailsSynt(e) {
            let a = e.target.value;
            let trs = document.querySelectorAll('#detailsSynt tr:not(tbody:first-of-type tr)');

            let regex = new RegExp(`${a}`, 'i')

            trs.forEach(e => {

                if (regex.test(e.getAttribute('name'))) {

                    e.classList.remove('d-none')

                } else {

                    e.classList.add('d-none')

                }

            })

        }
        function detailsSyntData(formateur) {
            let tableBody = []
            let tableHead = [[
                "N°",
                "Groupe",
                "Module",
                "MHP  S1",
                "MHSYN  S1",
                "MH Globale  S1",
                "MHP  S2",
                "MHSYN  S2",
                "MH Globale  S2",
                "MHP ",
                "MHSYN ",
                "MH Globale "
            ]]
            let tableBody2 = []
            let tableHead2 = [[
                "",
                "MH Affectée Présentiel ",
                "MH Affectée Sync ",
                "MH Affectée Globale (P & SYN)"
            ]]
            let data = dataDetailsSynt(formateur)


            let MHAfectGlobal = 0;
            let MHAfectGlobalP = 0;
            let MHAfectGlobalSYN = 0;

            let MHAfectGlobalS1 = 0;
            let MHAfectGlobalS1P = 0;
            let MHAfectGlobalS1SYN = 0;

            let MHAfectGlobalS2 = 0;
            let MHAfectGlobalS2P = 0;
            let MHAfectGlobalS2SYN = 0;

            let groupeSYN = [];

            data.map((module, i) => {
                let MHAfectGlobalModule = 0;
                let MHAfectGlobalPModule = 0;
                let MHAfectGlobalSYNModule = 0;

                let MHAfectGlobalS1Module = 0;
                let MHAfectGlobalS1PModule = 0;
                let MHAfectGlobalS1SYNModule = 0;

                let MHAfectGlobalS2Module = 0;
                let MHAfectGlobalS2PModule = 0;
                let MHAfectGlobalS2SYNModule = 0;
                let difSYN = 0
                let groupe = ""
                let groupeSpr = module.Groupe.split("")
                for (let t of groupeSpr) {
                    if (isNaN(t)) {

                        groupe += t

                    }
                    else {
                        groupe += t
                        break;
                    }

                }
                let countEx = groupeSYN.filter(m => (m.grp == groupe && m.Module == module["Code Module"]))

                if (!(module["Groupe"].includes("TREMOA") && (module["Module"].includes("Compétences") ||
                    module["Module"].includes("Français") || module["Module"].includes("Anglais")))) {

                    if (countEx.length > 0) {
                        if (!(module["Groupe"].includes("TREMOA"))) {

                            MHAfectGlobalModule = Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalPModule = Number(module["MHP Totale DRIF"]);


                            MHAfectGlobalS1Module = Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1PModule = Number(module["MHP S1 DRIF"]);

                            MHAfectGlobalS2Module = Number(module["MHP S2 DRIF"])
                            MHAfectGlobalS2PModule = Number(module["MHP S2 DRIF"]);

                            MHAfectGlobal += Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalP += Number(module["MHP Totale DRIF"]);


                            MHAfectGlobalS1 += Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1P += Number(module["MHP S1 DRIF"]);


                            MHAfectGlobalS2 += Number(module["MHP S2 DRIF"])
                            MHAfectGlobalS2P += Number(module["MHP S2 DRIF"]);

                        }
                        else {
                            if (module['MH Totale S1 DRIF'] != 0 && module['MH Totale S1 DRIF'] >= module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS1Module += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS1 += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                            }
                            if (module['MH Totale S2 DRIF'] != 0 && module['MH Totale S1 DRIF'] < module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS2Module += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);

                                MHAfectGlobalS2 += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                            }
                        }


                        let groupeSYNnew = groupeSYN.filter(e => !(e.grp == groupe && e.Module == module["Code Module"]))

                        groupeSYN = [...groupeSYNnew]
                    }
                    else {
                        groupeSYN.push({ grp: groupe, Module: module["Code Module"] })
                        if (!(module["Groupe"].includes("TREMOA"))) {

                            MHAfectGlobalModule = Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                            MHAfectGlobalPModule = Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalSYNModule = Number(module["MHSYN Totale DRIF"]);

                            MHAfectGlobalS1Module = Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                            MHAfectGlobalS1PModule = Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1SYNModule = Number(module["MHSYN S1 DRIF"]);

                            MHAfectGlobalS2Module = Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                            MHAfectGlobalS2PModule = Number(module["MHP S2 DRIF"]);
                            MHAfectGlobalS2SYNModule = Number(module["MHSYN S2 DRIF"]);

                            MHAfectGlobal += Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                            MHAfectGlobalP += Number(module["MHP Totale DRIF"]);
                            MHAfectGlobalSYN += Number(module["MHSYN Totale DRIF"]);

                            MHAfectGlobalS1 += Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                            MHAfectGlobalS1P += Number(module["MHP S1 DRIF"]);
                            MHAfectGlobalS1SYN += Number(module["MHSYN S1 DRIF"]);

                            MHAfectGlobalS2 += Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                            MHAfectGlobalS2P += Number(module["MHP S2 DRIF"]);
                            MHAfectGlobalS2SYN += Number(module["MHSYN S2 DRIF"]);
                        }
                        else {
                            if (module['MH Totale S1 DRIF'] != 0 && module['MH Totale S1 DRIF'] >= module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS1Module += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS1PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1SYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS1 += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS1P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS1SYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);
                            }
                            if (module['MH Totale S2 DRIF'] != 0 && module['MH Totale S1 DRIF'] < module['MH Totale S2 DRIF']) {
                                MHAfectGlobalModule += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalPModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS2Module += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS2PModule += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2SYNModule += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobal += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalP += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalSYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);

                                MHAfectGlobalS2 += Number(module["MH Affectée Globale (P & SYN)"]) || Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                                MHAfectGlobalS2P += Number(module["MH Affectée Présentiel"]) || Number(module["MHP Totale DRIF"]);
                                MHAfectGlobalS2SYN += Number(module["MH Affectée Sync"]) || Number(module["MHSYN Totale DRIF"]);
                            }
                        }
                    }
                }
                else {
                    MHAfectGlobalModule = Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                    MHAfectGlobalPModule = Number(module["MHP Totale DRIF"]);
                    MHAfectGlobalSYNModule = Number(module["MHSYN Totale DRIF"]);

                    MHAfectGlobalS1Module = Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                    MHAfectGlobalS1PModule = Number(module["MHP S1 DRIF"]);
                    MHAfectGlobalS1SYNModule = Number(module["MHSYN S1 DRIF"]);

                    MHAfectGlobalS2Module = Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                    MHAfectGlobalS2PModule = Number(module["MHP S2 DRIF"]);
                    MHAfectGlobalS2SYNModule = Number(module["MHSYN S2 DRIF"]);
                    MHAfectGlobal += Number(module["MH Totale  DRIF"] - module["MHASYN Totale DRIF"]);
                    MHAfectGlobalP += Number(module["MHP Totale DRIF"]);
                    MHAfectGlobalSYN += Number(module["MHSYN Totale DRIF"]);

                    MHAfectGlobalS1 += Number(module["MH Totale S1 DRIF"] - module["MHASYN S1 DRIF"]);
                    MHAfectGlobalS1P += Number(module["MHP S1 DRIF"]);
                    MHAfectGlobalS1SYN += Number(module["MHSYN S1 DRIF"]);

                    MHAfectGlobalS2 += Number(module["MH Totale S2 DRIF"] - module["MHASYN S2 DRIF"])
                    MHAfectGlobalS2P += Number(module["MHP S2 DRIF"]);
                    MHAfectGlobalS2SYN += Number(module["MHSYN S2 DRIF"]);
                }


                tableBody = [...tableBody, [
                    i + 1,
                    module["Groupe"],
                    `${module['Code Module']}-${module['Module']}`,
                    Number(MHAfectGlobalS1PModule).toFixed(2),
                    Number(MHAfectGlobalS1SYNModule).toFixed(2),
                    { content: Number(MHAfectGlobalS1Module).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS2PModule).toFixed(2),
                    Number(MHAfectGlobalS2SYNModule).toFixed(2),
                    { content: Number(MHAfectGlobalS2Module).toFixed(2), styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalPModule).toFixed(2),
                    Number(MHAfectGlobalSYNModule).toFixed(2),
                    { content: Number(MHAfectGlobalModule).toFixed(2), styles: { fontStyle: 'bold' } }
                ]]
            })





            tableBody2 = [
                [
                    { content: " total S1", styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS1P).toFixed(2),
                    Number(MHAfectGlobalS1SYN).toFixed(2),

                    { content: Number(MHAfectGlobalS1).toFixed(2), styles: { fontStyle: 'bold' } },

                ],
                [
                    { content: " total S2", styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalS2P).toFixed(2),
                    Number(MHAfectGlobalS2SYN).toFixed(2),

                    { content: Number(MHAfectGlobalS2).toFixed(2), styles: { fontStyle: 'bold' } },
                ],
                [
                    { content: " total d'annee", styles: { fontStyle: 'bold' } },
                    Number(MHAfectGlobalP).toFixed(2),
                    Number(MHAfectGlobalSYN).toFixed(2),

                    { content: Number(MHAfectGlobal).toFixed(2), styles: { fontStyle: 'bold' } },

                ]
            ];





            // divParent.appendChild(input);
            return {
                formateur: formateur,
                mle: data[0]["Mle Affecté Présentiel Actif"],
                tableBody: tableBody,
                tableBody2: tableBody2,
                tableHead: tableHead,
                tableHead2: tableHead2
            }

        }

        function imprimeToutTableSrv(type) {
            let data;
            if (type == "Pr") {
                data = dataformateurPr()
                type = "Permanents"
            }
            console.log(type);
            if (type == "Vct") {
                data = dataformateurVct()
                type = "Vacataires"
            }
            setTimeout(() => {
                const jsPDF = new window.jspdf.jsPDF();
                let logo = "https://upload.wikimedia.org/wikipedia/commons/0/05/Logo_ofppt.png";

                const generatePDF = () => {
                    const currentDate = new Date().toLocaleDateString();

                    const pdf = new window.jspdf.jsPDF({
                        format: 'a4',
                        orientation: 'landscape',
                    });

                    const img = new Image();
                    img.src = logo;
                    img.onload = function () {
                        data.map((formateur, i) => {
                            let dataformateur = detailsSyntData(formateur)

                            pdf.addImage(this, 'PNG', 10, 5, 25, 25);

                            pdf.setFontSize(10);
                            pdf.text(currentDate, 270, 5);

                            pdf.text('Institut Spécialisé de Technologie Appliquée - Berkane', 195, 20);

                            pdf.setFontSize(14);
                            pdf.text('Tableau de service ', 120, 33);

                            pdf.setFontSize(10);
                            pdf.text('Direction: DR Oriental', 15, 45);
                            pdf.text('Complexe: CF Berkane', 15, 50);
                            pdf.text('Formateur: ' + dataformateur.formateur, 120, 45);
                            pdf.text('Matricule: ' + dataformateur.mle, 120, 50);
                            pdf.text('Année de formation: 2023-2024', 230, 50);

                            // بداية الجدول
                            pdf.autoTable({
                                head: dataformateur.tableHead,
                                body: dataformateur.tableBody,
                                startY: 57,
                                headStyles: { align: 'center' },
                                bodyStyles: { align: 'center' },
                            });
                            pdf.autoTable({
                                head: dataformateur.tableHead2,
                                body: dataformateur.tableBody2,
                                headStyles: { fillColor: [0, 128, 0], align: 'center' },
                                bodyStyles: { align: 'center' },


                            });
                            if (i != data.length - 1)
                                pdf.addPage();

                        })

                        pdf.save("lse_Tableaux_de_service_" + 'des_' + type + "_" + (new Date().toLocaleDateString()) + '.pdf');
                    };
                };

                generatePDF();
            }, 500);
        }

    </script>
</body>

</html>